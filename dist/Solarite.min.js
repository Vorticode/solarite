// Version 2024.7.18.0356
// License: MIT
// https://github.com/vorticode/Solarite
var Util$1={callback(...t){var e=!1;let l=async(...t)=>{let s=[];if(!e)for(let e=0;l.length>e;e++)s.push(l[e](...t));return await Promise.all(s)};l[Symbol.iterator]=()=>{let t=0;return{next(){return l.length>t?{value:l[t++],done:!1}:{done:!0}}}};for(let t of Object.getOwnPropertyNames(Array.prototype))"length"!==t&&"constructor"!==t&&(l[t]=Array.prototype[t]);l.l=0,Object.defineProperty(l,"length",{get:()=>l.l,set(t){l.l=t}}),l.remove=t=>{let e=l.findIndex((e=>e===t));-1!==e&&l.splice(e,1)},l.pause=()=>e=!0,l.resume=()=>e=!1;for(let e of t)l.push(e);return l}};function delve(t,e,l=delveDontCreate){let s=l!==delveDontCreate,r=e.length;if(!t&&!s&&r)return;let i=0;for(let o of e){if(void 0===t[o]){if(!s)return;r-1>i&&(t[o]=(e[i+1]+"").match(/^\d+$/)?[]:{})}s&&i===r-1&&(t[o]=l),t=t[o],i++}return t}let delveDontCreate={};function getArg(el,name,val=null,type=ArgType.String){let attrVal=el.getAttribute(name);if(null!==attrVal&&(val=attrVal),Array.isArray(type))return type.includes(val)?val:void 0;if("function"==typeof type)return type(val);if(type===ArgType.Bool){let t="string"==typeof val?val.toLowerCase():val;return!["false","0",!1,0,null,void 0].includes(t)}switch(type){case ArgType.Int:return parseInt(val);case ArgType.Float:return parseFloat(val);case ArgType.String:return[void 0,null,!1].includes(val)?"":val+"";case ArgType.JSON:case ArgType.Eval:if("string"!=typeof val||!val.length)return val;try{return type===ArgType.JSON?JSON.parse(val):eval(`(${val})`)}catch(t){return val}default:return val}}var ArgType={Bool:"Bool",Int:"Int",Float:"Float",String:"String",JSON:"JSON",Eval:"Eval"};let lastObjectId=1,objectIds=new WeakMap;function getObjectId(t,e=null){e=e||"~\f";let l=objectIds.get(t);return l||(l=e+lastObjectId++,objectIds.set(t,l)),l}let isHashing=!0;function toJSON(){return isHashing?getObjectId(this):this}function getObjectHash(t){let e;Node.prototype.toJSON!==toJSON&&(Node.prototype.toJSON=toJSON,(()=>{}).toJSON!==toJSON&&(Function.prototype.toJSON=toJSON)),isHashing=!0;try{e=JSON.stringify(t)}catch(l){e=getObjectHashCircular(t)}return isHashing=!1,e}function getObjectHashCircular(t){const e=new Set;return JSON.stringify(t,((t,l)=>{if("object"==typeof l&&null!==l){if(e.has(l))return getObjectId(l);e.add(l)}return l}))}class MultiValueMap{data={};add(t,e){let l=this.data,s=l[t];s||(s=new Set,l[t]=s),s.add(e)}getAll(t){return this.data[t]||[]}delete(t,e=void 0){let l,s=this.data,r=s[t];if(r)return void 0!==e?(r.delete(e),l=e):(l=r.values().next().value,r.delete(l)),0===r.size&&delete s[t],l}hasValue(t){let e=this.data,l=[];for(let s in e)e[s].has(t)&&l.push(s);return l}}let Util={bindStyles(t,e){let l=e.getAttribute("data-style");l||(e.constructor.styleId||(e.constructor.styleId=1),l=e.constructor.styleId++,e.setAttribute("data-style",l));let s=e.tagName.toLowerCase();for(let e of t.childNodes)if(3===e.nodeType){let t=e.textContent,r=t.replace(/:host(?=[^a-z0-9_])/gi,s+'[data-style="'+l+'"]');t!==r&&(e.textContent=r)}}},div=document.createElement("div"),isEvent=t=>t.startsWith("on")&&t in div;function camelToDashes(t){return(t=(t=(t=t.replace(/([a-z0-9])([A-Z])/g,"$1-$2")).replace(/([A-Z])([A-Z][a-z])/g,"$1-$2")).replace(/([a-zA-Z])([0-9])/g,"$1-$2")).toLowerCase()}function findArrayDiff(t,e){if(t.length!==e.length)return-1;let l=t.length;for(let s=0;l>s;s++)if(t[s]!==e[s])return s;return!1}function htmlContext(t){if(null===t)return state={...defaultState},state.context;for(let e=0;t.length>e;e++){const l=t[e];switch(state.context){case htmlContext.Text:"<"===l&&t[e+1].match(/[a-z!]/i)&&(state.context=htmlContext.Tag,state.buffer="");break;case htmlContext.Tag:if(">"===l)state.context=htmlContext.Text,state.quote=null,state.buffer="";else{if(" "===l&&!state.buffer)continue;" "===l||"/"===l||"?"===l?state.buffer="":'"'===l||"'"===l||"="===l?(state.context=htmlContext.Attribute,state.quote="="===l?null:l,state.buffer=""):state.buffer+=l}break;case htmlContext.Attribute:state.quote||state.buffer.length||'"'!==l&&"'"!==l?l===state.quote||!state.quote&&state.buffer.length?(state.context=htmlContext.Tag,state.quote=null,state.buffer=""):state.quote||">"!==l?" "!==l&&(state.buffer+=l):(state.context=htmlContext.Text,state.quote=null,state.buffer=""):state.quote=l}}return state.context}htmlContext.Attribute="Attribute",htmlContext.Text="Text",htmlContext.Tag="Tag";let defaultState={context:htmlContext.Text,quote:null,buffer:"",lastChar:null},state={...defaultState};class Template{exprs=[];html=[];replaceMode;hashedFields;parentPath;nodeGroup;paths=[];constructor(t,e){this.html=t,this.exprs=e}toJSON(){return this.hashedFields||(this.hashedFields=[getObjectId(this.html,"Html"),this.exprs]),this.hashedFields}render(t=null,e={}){let l;t||(l=new NodeGroup(this),t=l.getParentNode());let s=NodeGroupManager.get(t);if(l&&(l.manager=s),s.options=e,s.clearSubscribers=!1,s.mutationWatcherEnabled=!1,1!==this.html?.length||this.html[0]){let e,l=s.getNodeGroup(this,!0);l||(e=s.getNodeGroup(this,!1));let r=!s.rootNg;s.rootNg=l||e;let i=s.rootNg.getParentNode();if(r){let e;if(t.childNodes.length&&(e=document.createDocumentFragment(),e.append(...t.childNodes)),i instanceof DocumentFragment?t.append(i):i&&t.append(...i.childNodes),e){for(let l of t.querySelectorAll("slot[name]")){let t=l.getAttribute("name");t&&l.append(...e.querySelectorAll(`[slot='${t}']`))}let l=t.querySelector("slot:not([name])");l&&l.append(e)}}s.rootEl=t;let o=s.rootNg;if(o.pseudoRoot&&o.pseudoRoot!==t&&r)for(let e of o.pseudoRoot.attributes)t.hasAttribute(e.name)||t.setAttribute(e.name,e.value);s.reset(),window.ngm=s}else t.innerHTML="";return s.mutationWatcherEnabled=!0,t}getCloseKey(){return"@"+this.hashedFields[0]}}class TransformerInfo{constructor(t,e,l){this.path=t,this.transformer=e,this.hash=l}}let pathToTransformer=new MultiValueMap;function watchGet(...t){let e,l=t.at(-1);if("function"==typeof l)e=t.slice(0,-1);else if(1===t.length){e=[t[0].slice(0,-1)];let s=t[0].at(-1);l=(...t)=>t[0][s]}let s=[];for(let t of e){let e=delve(watchSet(t[0]),t.slice(1));s.push(e)}let r=l(...s);if(!(r instanceof Template)){let t=l;l=function(){return new Template(["",""],[t(...arguments)])},r=l(...s)}let i=getObjectHash(r);for(let t of e){let e=serializePath(t);pathToTransformer.add(e,new TransformerInfo(t,l,i))}return r}function watchSet(t){return!0===t?.$isProxy?t:new Proxy(t,new ProxyHandler$1(t))}function forEach(t,e){let l=delve(t[0],t.slice(1)),s=NodeGroupManager.get(t[0]);s.clearSubscribers&&(s.clearSubscribers=!1,s.pathToLoopInfo=new MultiValueMap);let r=[...l.map(((l,s)=>watchGet([...t,s],e)))],i=new Template(["",""],[r]),o=new LoopInfo(i,e);return s.pathToLoopInfo.add(serializePath(t),o),i}function serializePath(t){return JSON.stringify([getObjectId(t[0]),...t.slice(1).map((t=>t+""))])}class ProxyHandler$1{constructor(t,e=[]){this.root=t,this.path=e}get(t,e){if("$isProxy"===e)return!0;if("splice"===e&&Array.isArray(t))return(e,l,...s)=>{let r=NodeGroupManager.get(this.root);if(l){let t=[];for(let s=e;e+l>s;s++){let e=serializePath([this.root,...this.path,s+""]),l=delve(this.root,[...this.path,s]);for(let s of pathToTransformer.getAll(e)){let e=getObjectHash(s.transformer(l));t.push(e)}}r.changes.push(new Change("delete",this.root,[...this.path,e+""],t))}let i=t.splice(e,l);if(s.length){let l;for(let t of r.getLoopInfo([this.root,...this.path])){let i=delve(this.root,[...this.path,e]);if(i){let o=t.itemTransformer(i),n=getObjectHash(o);if(l=r.nodeGroupsAvailable.data[n],l){let i=getObjectHash(t.template),n=r.nodeGroupsAvailable.data[i]||[];for(let t of n)for(let i of l)i.startNode.parentNode===t.startNode.parentNode&&r.changes.push(new Change("insert",this.root,[...this.path,e+""],s,o))}}l||r.changes.push(new Change("insert",this.root,[...this.path,e+""],s))}t.splice(e,0,...s)}return i};let l=Reflect.get(t,e);if(l&&"object"==typeof l){let t=new ProxyHandler$1(this.root,[...this.path,e]);return new Proxy(l,t)}return l}set(t,e,l){return NodeGroupManager.get(this.root).changes.push(new Change("set",this.root,[...this.path,e],l)),Reflect.set(t,e,l)}}class Change{constructor(t,e,l,s,r=null){this.action=t,this.root=e,this.path=l,this.value=s,this.beforeTemplate=r,this.transformerInfo=[];for(let t=this.path.length;t>0;t--){let e=this.path.slice(0,t),l=getObjectHash([this.root,...e]);this.transformerInfo.push(...pathToTransformer.getAll(l))}}}let withinSet=0;function watch(t,...e){if(!e.length)return t?.$proxyHandler?t:new Proxy(t,new ProxyHandler(t));{let l={};for(let s of e)l[s]=t[s],Object.defineProperty(t,s,{get:()=>new Proxy(t,new ProxyHandler(t,[],l))[s],set(t){return watch(this)[s]=t}})}}class ProxyHandler{serializedPath;constructor(t,e=[],l=null){this.root=t,this.path=e,this.props=l}getSerializedPath(t=null){return this.serializedPath||(this.serializedPath=JSON.stringify([getObjectId(this.root),...this.path.map((t=>t+""))])),null!==t?this.serializedPath.slice(0,-1)+',"'+t+'"]':this.serializedPath}extend(t){t+="",assert(!this.root.$proxyHandler);let e=new ProxyHandler(this.root,[...this.path,t],this.props);return this.serializedPath&&(e.serializedPath=this.getSerializedPath(t)),e}get(t,e){if("$proxyHandler"===e)return this;if("$removeProxy"===e)return delve(this.props||this.root,this.path);if("map"===e&&Array.isArray(t)){let e=NodeGroupManager.get(this.root);return e.clearSubscribersIfNeeded(),l=>{let s,r=[],i=t=>{let i=[];for(let o=0;t.length>o;o++){let n=this.extend(o),a=t[o];a.$proxyHandler||(a=new Proxy(a,n));let h=l(a,o,t);i.push(h);let f=this.getSerializedPath(o),u=new Subscriber(l,h);u.parent=s,e.subscribers.add(f,u),r.push([f,u])}return new Template(["",""],[i])};withinSet||(s=new Subscriber(i,null,l));let o=i(t);return withinSet||(s.template=o,s.children=r,e.subscribers.add(this.getSerializedPath(),s)),o}}if("splice"!==e&&"fastSplice"!==e||!Array.isArray(t)){if("indexOf"===e&&Array.isArray(t))return e=>t.indexOf(e.$removeProxy||e);{let l=Reflect.get(t===this.root&&this.props?this.props:t,e);if(l&&"object"==typeof l){let t=this.extend(e);return new Proxy(l,t)}return l}}{let l=NodeGroupManager.get(this.root);return(s,r,...i)=>{let o=i.length-r,n=t.length;if(r)for(let t=s;s+r>t;t++){let e=this.getSerializedPath(t);for(let t of l.subscribers.data[e]||[]){let e=t.template.nodeGroup;for(let t of e.getNodes())t.remove();l.nodeGroupsAvailable.delete(e.exactKey,e)}delete l.subscribers.data[e]}if(o){let t=this.getSerializedPath(),a=[...l.subscribers.getAll(t)][0],h=t=>{let s=t+o,r=this.getSerializedPath(t),i=this.getSerializedPath(s),n=l.subscribers.data[r];if(delete l.subscribers.data[r],l.subscribers.data[i]=n,"splice"===e){let e=delve(this.root,this.path);for(let l of n){let r=l.template.nodeGroup,i=getProxy(e[t],this,this.path,s),o=a.itemTransformer(i,s).exprs;r.applyExprs(o)}}};if(o>0)for(let t=n-1;t>=s+i.length+r;t--)h(t);else for(let t=s+i.length+r;n>t;t++)h(t)}if(i.length){let t=this.getSerializedPath(),e=this.getSerializedPath(s),l=NodeGroupManager.get(this.root);for(let o of l.subscribers.getAll(t)){let t=n-r>s?[...l.subscribers.getAll(e)].map((t=>t.template.nodeGroup.startNode)):[o.template.nodeGroup.endNode];for(let e of t)for(let t=0;i.length>t;t++){let r=this.extend(s+t);assert(!i[t].$proxyHandler);let n=new Proxy(i[t],r),a=o.itemTransformer(n),h=l.getNodeGroup(a,null,!0);for(let t of h.getNodes())e.parentNode.insertBefore(t,e);let f=r.getSerializedPath(),u=new Subscriber(o.itemTransformer,a);u.parent=o,l.subscribers.add(f,u)}o.template.nodeGroup.parentPath.clearNodesCache(),o.template.nodeGroup.nodesCache=null}}return t.splice(s,r,...i)}}}set(t,e,l){withinSet++;let s=Reflect.set(t===this.root&&this.props?this.props:t,e,l),r=[...this.path,e+""];return this.notify(r),withinSet--,s}notify(t,e=new Set){let l=NodeGroupManager.get(this.root),s=getObjectId(this.root),r=t.length;for(;r>=1;){let i=t.slice(0,r),o=delve(this.root,i),n=JSON.stringify([s,...i]);for(let t of l.subscribers.getAll(n)){if(e.has(t))continue;if(t.children){for(let[e,s]of t.children)l.subscribers.delete(e,s);t.children=void 0}let s=getProxy(o,this,i),r=t.transformer(s).exprs;for(let e of t.template.nodeGroup.paths)e.clearNodesCache();t.template.nodeGroup.applyExprs(r),t.parent&&e.add(t.parent)}r--}}}function getProxy(t,e,l,s){return t}class Subscriber{parent;children;constructor(t,e,l=null){this.transformer=t,this.template=e,this.itemTransformer=l}}class ExprPath{type;attrName;attrValue;attrNames;nodeBefore;nodeMarker;get parentNode(){return this.nodeMarker.parentNode}parentNg;nodeGroups=[];nodesCache;nodeBeforeIndex;nodeMarkerPath;expr;constructor(t,e,l=PathType.Content,s=null,r=null){this.nodeBefore=t,this.nodeMarker=e,this.type=l,this.attrName=s,this.attrValue=r,l===PathType.Multiple&&(this.attrNames=new Set)}apply(t,e,l){if(t instanceof Template){t.nodegroup=this.parentNg;let s=this.parentNg.manager.getNodeGroup(t,!0);s?(e.push(...s.getNodes()),this.nodeGroups.push(s)):(l.push([e.length,this.nodeGroups.length]),e.push(t),this.nodeGroups.push(null))}else if(t instanceof Node)t instanceof DocumentFragment?e.push(...t.childNodes):e.push(t);else if(Array.isArray(t))for(let s of t)this.apply(s,e,l);else if("function"==typeof t){let s=t();this.apply(s,e,l)}else{let l=void 0===t||!1===t||null===t?"":t+"",s=this.nodeBefore.nextSibling;if(3!==s.nodeType||s.nextSibling!==this.nodeMarker||e.includes(s)){this.existingTextNodes||(this.existingTextNodes=this.getNodes().filter((t=>3===t.nodeType)));let t=this.existingTextNodes.findIndex((t=>t.textContent===l));-1!==t?e.push(...this.existingTextNodes.splice(t,1)):e.push(this.parentNode.ownerDocument.createTextNode(l))}else s.textContent!==l&&(s.textContent=l),e.push(s)}}applyMultipleAttribs(t,e){Array.isArray(e)&&(e=e.flat().join(" "));let l=this.attrNames;if(this.attrNames=new Set,e){let l=(e+"").split(/([\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^\s]+))/g).map((t=>t.trim())).filter((t=>t.length));for(let e of l){let[l,s]=e.split(/\s*=\s*/);s=(s||"").replace(/^(['"])(.*)\1$/,"$2"),t.setAttribute(l,s),this.attrNames.add(l)}}for(let e of l)this.attrNames.has(e)||t.removeAttribute(e)}applyEventAttrib(t,e,l){let s,r=this.attrName.slice(2),i=[];if(Array.isArray(e)){for(let t=0;e.length>t;t++)if("function"==typeof e[t]){s=e[t],i=e.slice(t+1);break}s||(s=setValue,i=[e[0],e.slice(1),t],t.value=delve(e[0],e.slice(1)))}else s=e;let o=getObjectId(t)+r,[n,a]=nodeEvents[o]||[];if(nodeEventArgs[o]=i,n!==s){n&&t.removeEventListener(r,a);let e=s,h=s=>e.call(l,...i,s,t);nodeEvents[o]=[e,h],t.addEventListener(r,h)}}applyValueAttrib(t,e,l){let s=e[l];if(this.attrValue||!1!==s&&null!=s)if(this.attrValue||!0!==s){let r=[];if(this.attrValue){for(let t=this.attrValue.length-1;t>=0;t--)if(r.unshift(this.attrValue[t]),t>0){let t=e[l];!1!==t&&null!=t&&r.unshift(t),l--}l++}else r.unshift(s);let i=r.join("");t.setAttribute(this.attrName,i),this.attrName in t&&(t[this.attrName]=i)}else t.setAttribute(this.attrName,"");else t.removeAttribute(this.attrName);return l}clone(t){let e,l,s=t,r=this.nodeMarkerPath;for(let t=r.length-1;t>0;t--)s=s.childNodes[r[t]];let i=s.childNodes;return e=i[r[0]],this.nodeBefore&&(l=i[this.nodeBeforeIndex]),new ExprPath(l,e,this.type,this.attrName,this.attrValue)}clearNodesCache(){let t=this,e=this.parentNode;for(;t&&t.parentNode===e;)t.nodesCache=null,t=t.parentNg?.parentPath;!function t(l){for(let s of l.nodeGroups)if(s)for(let l of s.paths)l.type===PathType.Content&&l.parentNode===e&&(l.nodesCache=null,t(l))}(this)}fastClear(){let t=this.nodeBefore.parentNode;if(this.nodeBefore===t.firstChild&&this.nodeMarker===t.lastChild){let e=t.parentNode;if(e&&t===e.firstChild&&t===e.lastChild&&!t.hasAttribute("id")){let e=document.createElement(t.tagName);e.append(this.nodeBefore,this.nodeMarker);for(let l of t.attributes)e.setAttribute(l.name,l.value);t.replaceWith(e)}else t.innerHTML="",t.append(this.nodeBefore,this.nodeMarker);return!0}return!1}getNodes(){let t;t=[];let e=this.nodeBefore.nextSibling,l=this.nodeMarker;for(;e&&e!==l;)t.push(e),e=e.nextSibling;return this.nodesCache=t,t}getParentNode(){return this.nodeMarker.parentNode}removeNodeGroup(t){let e=this.nodeGroups.indexOf(t);this.nodeGroups.splice(e),t.parentPath=null,this.clearNodesCache()}}function setValue(t,e,l){let s=l.value;"number"===l.type&&(s=parseFloat(s)),delve(t,e,s)}const PathType={Content:"content",Multiple:"attrName",Value:"attrValue",Component:"component",Comment:"comment"};function getNodePath(t){let e=[];for(;;){let l=t.parentNode;if(!l)break;e.push([].indexOf.call(t.parentNode.childNodes,t)),t=l}return e}function resolveNodePath(t,e){for(let l=e.length-1;l>=0;l--)t=t.childNodes[e[l]];return t}let nodeEvents={},nodeEventArgs={};class Shell{fragment;paths=[];template;events=[];ids=[];scripts=[];styles=[];staticComponents=[];constructor(t=null){if(!t)return;let e=[],l="\x3c!--!✨!--\x3e",s={};htmlContext(null);for(let r=0;t.length>r;r++){let i=t[r],o=htmlContext(i);if(o===htmlContext.Attribute){let t,e;if(i.replace(/<[a-z][a-z0-9]*-[a-z0-9-]+/gi,((l,s)=>{t=s+1,e=l.slice(1)})),e){let l=e+"-solarite-placeholder";i=i.slice(0,t)+l+i.slice(t+e.length),s[e]=l}}e.push(i),t.length-1>r&&e.push(o===htmlContext.Text?l:String.fromCharCode(57344+r))}let r,i=document.createElement("template"),o=e.join("");for(let t in s)o=o.replaceAll(`</${t}>`,`</${s[t]}>`);o?i.innerHTML=o:i.content.append(document.createTextNode("")),this.fragment=i.content;let n=[];const a=document.createTreeWalker(i.content,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT);for(;r=a.nextNode();)if(n.map((t=>t.remove())),n=[],1===r.nodeType)for(let t of[...r.attributes]){let e=t.name.match(/^[\ue000-\uf8ff]$/);if(e)this.paths.push(new ExprPath(null,r,PathType.Multiple)),r.removeAttribute(e[0]);else{let e=t.value.split(/[\ue000-\uf8ff]/g);e.length>1&&(this.paths.push(new ExprPath(null,r,PathType.Value,t.name,2!==e.length||e[0].length||e[1].length?e:null)),r.setAttribute(t.name,e.join("")))}}else if(r.nodeType===Node.COMMENT_NODE&&"!✨!"===r.nodeValue){let t,e=r.previousSibling;e||(e=document.createComment("PathStart:"+this.paths.length),r.parentNode.insertBefore(e,r)),!r.nextSibling||8===r.nextSibling.nodeType&&"!✨!"===r.nextSibling.textContent?(t=r,t.textContent="PathEnd:"+this.paths.length):(t=r.nextSibling,n.push(r));let l=new ExprPath(e,t,PathType.Content);this.paths.push(l)}else if(r.nodeType===Node.COMMENT_NODE){let t=r.textContent.split(/[\ue000-\uf8ff]/g);for(let e=0;t.length-1>e;e++){let t=new ExprPath(r.previousSibling,r);t.type=PathType.Comment,this.paths.push(t)}}else if(r.nodeType===Node.TEXT_NODE&&["SCRIPT","STYLE"].includes(r.parentNode?.nodeName)){let t=r.textContent.split(l);if(t.length>1){let e=[];for(let l=0;t.length>l;l++){let s=document.createTextNode(t[l]);r.parentNode.insertBefore(s,r),l>0&&e.push(s)}for(let t,l=0;t=e[l];l++){let e=new ExprPath(t.previousSibling,t,PathType.Content);this.paths.push(e)}n.push(r)}}n.map((t=>t.remove()));for(let t of this.fragment.querySelectorAll("[is]"))t.setAttribute("_is",t.getAttribute("is"));for(let t of this.paths)t.nodeBefore&&(t.nodeBeforeIndex=[].indexOf.call(t.nodeBefore.parentNode.childNodes,t.nodeBefore)),t.nodeMarkerPath=getNodePath(t.nodeMarker),t.type===PathType.Value&&1===t.nodeMarker.nodeType&&(t.nodeMarker.tagName.includes("-")||t.nodeMarker.hasAttribute("is"))&&(t.type=PathType.Component);this.findEmbeds()}findEmbeds(){this.scripts=[].map.call(this.fragment.querySelectorAll("scripts"),(t=>getNodePath(t))),this.styles=[].map.call(this.fragment.querySelectorAll("style"),(t=>getNodePath(t)));let t=this.fragment.querySelectorAll("[id],[data-id]");for(let e of t){let t=e.getAttribute("data-id")||e.getAttribute("id");if(div.hasOwnProperty(t))throw Error(`<${e.tagName.toLowerCase()} id="${t}"> can't override existing HTMLElement property.`)}this.ids=[].map.call(t,(t=>getNodePath(t)));for(let t of this.fragment.querySelectorAll("*")){for(let e of t.attributes)isEvent(e.name)&&this.events.push([e.name,getNodePath(t)]);(t.tagName.includes("-")||t.hasAttribute("_is"))&&(this.paths.find((e=>e.nodeMarker===t))||this.staticComponents.push(getNodePath(t)))}}static get(t){let e=shells.get(t);return e||(e=new Shell(t),shells.set(t,e)),e}}let shells=new WeakMap;const udomdiff=(t,e,l,s)=>{const r=l.length;let i=e.length,o=r,n=0,a=0,h=null;for(;i>n||o>a;)if(i===n){const e=r>o?a?l[a-1].nextSibling:l[o-a]:s;for(;o>a;){let s=l[a++];t.insertBefore(s,e)}}else if(o===a)for(;i>n;){let l=e[n];h&&h.has(l)||t.removeChild(l),n++}else if(e[n]===l[a])n++,a++;else if(e[i-1]===l[o-1])i--,o--;else if(e[n]===l[o-1]&&l[a]===e[i-1]){const s=e[--i].nextSibling;let r=l[a++],h=e[n++];t.insertBefore(r,h.nextSibling);let f=l[--o];t.insertBefore(f,s),e[i]=l[o]}else{if(!h){h=new Map;let t=a;for(;o>t;)h.set(l[t],t++)}if(h.has(e[n])){const s=h.get(e[n]);if(s>a&&o>s){let r=n,f=1;for(;++r<i&&o>r&&h.get(e[r])===s+f;)f++;if(f>s-a){const r=e[n];for(;s>a;){let e=l[a++];t.insertBefore(e,r)}}else{let s=e[n++],r=l[a++];t.replaceChild(r,s)}}else n++}else{let l=e[n++];t.removeChild(l)}}return l};class NodeGroup{manager;parentPath;startNode;endNode;paths=[];exactKey;closeKey;inUse;nodesCache;styles;pseudoRoot;currentComponentProps={};constructor(t,e=null){this.template=t,this.manager=e,t.nodeGroup=this;let l=Shell.get(t.html),s=l.fragment.cloneNode(!0),r="boolean"==typeof t.replaceMode?t.replaceMode:1===s.children.length&&s.firstElementChild?.tagName.replace(/-SOLARITE-PLACEHOLDER$/,"")===e?.rootEl?.tagName;r&&(this.pseudoRoot=s.firstElementChild);let i=r?s.firstElementChild.childNodes:s.childNodes;this.startNode=i[0],this.endNode=i[i.length-1];for(let t of l.paths){let e=t.clone(s);e.parentNg=this,this.paths.push(e)}this.activateEmbeds(s,l),this.applyExprs(t.exprs)}activateEmbeds(root,shell){for(let t of shell.staticComponents){let e=resolveNodePath(root,t);e.tagName!==this.pseudoRoot?.tagName&&this.createNewComponent(e)}if(this.manager?.rootEl){if(!1!==this.manager.options.ids)for(let t of shell.ids){let e=resolveNodePath(root,t),l=e.getAttribute("data-id")||e.getAttribute("id");this.manager.rootEl[l]=e}if(!1!==this.manager.options.styles){shell.styles.length&&(this.styles=new Map);for(let t of shell.styles){let e=resolveNodePath(root,t);Util.bindStyles(e,this.manager.rootEl),this.styles.set(e,e.textContent)}}if(!1!==this.manager.options.scripts)for(let path of shell.scripts){let script=resolveNodePath(root,path);eval(script.textContent)}}}applyExprs(t,e=null){e=e||this.paths;let l,s,r=t.length-1;for(let i of e.toReversed()){if(l=t[r],i.type===PathType.Content)this.applyNodeExpr(i,l);else{let e=i.nodeMarker,o=this.manager?.rootEl&&e===this.pseudoRoot?this.manager.rootEl:e;s&&s!==this.pseudoRoot&&s!==e&&Object.keys(this.currentComponentProps).length&&(this.applyComponentExprs(s,this.currentComponentProps),this.currentComponentProps={}),i.type===PathType.Multiple?i.applyMultipleAttribs(o,l):i.nodeMarker!==this.pseudoRoot&&i.type===PathType.Component?this.currentComponentProps[i.attrName]=l:i.type===PathType.Comment||(null===i.attrValue&&("function"==typeof l||Array.isArray(l))&&isEvent(i.attrName)?i.applyEventAttrib(o,l,this.manager?.rootEl||this.startNode.parentNode):r=i.applyValueAttrib(o,t,r)),s=i.nodeMarker}r--}s&&s!==this.pseudoRoot&&Object.keys(this.currentComponentProps).length&&(this.applyComponentExprs(s,this.currentComponentProps),this.currentComponentProps={}),this.updateStyles(),this.nodesCache=null}applyExpr(t,e){}applyNodeExpr(t,e){let l=[],s=t.nodeGroups,r=[];t.nodeGroups=[],t.apply(e,l,r),this.existingTextNodes=null;let i=!1;if(r.length){for(let[e,s]of r){let r=this.manager.getNodeGroup(l[e],!1);r.parentPath=t;let o=r.getNodes();1===o.length?l[e]=o[0]:(l[e]=o,i=!0),t.nodeGroups[s]=r}i&&(l=l.flat())}let o=t.getNodes();t.nodesCache=l,!1!==findArrayDiff(o,l)&&(this.parentPath&&this.parentPath.clearNodesCache(),o.length&&!l.length&&t.fastClear(o,l)||udomdiff(t.parentNode,o,l,t.nodeMarker),this.saveOrphans(s,o))}saveOrphans(t,e){let l=new Map;for(let e of t)l.set(e.startNode,e);for(let t,s=0;t=e[s];s++){let r;if(!t.parentNode&&(r=l.get(t))){let l=document.createDocumentFragment(),i=r.endNode;for(;t!==i;)l.append(t),s++,t=e[s];l.append(i)}}}applyComponentExprs(t,e){let l=getObjectHash(e),s=t.tagName.endsWith("-SOLARITE-PLACEHOLDER"),r=t.hasAttribute("_is");s||r?t=this.createNewComponent(t,s,e):t.render&&componentHash.get(t)!==l&&t.render(e),componentHash.set(t,l)}createNewComponent(t,e=void 0,l=void 0){void 0===e&&(e=!t.hasAttribute("_is"));let s=(e?t.tagName.endsWith("-SOLARITE-PLACEHOLDER")?t.tagName.slice(0,-21):t.tagName:t.getAttribute("is")).toLowerCase(),r={...l||{}};if(t.attributes.length){l||(l={});for(let e of t.attributes)l.hasOwnProperty(e.name)||(l[e.name]=e.value)}let i=customElements.get(s);if(!i)throw Error(`The custom tag name ${s} is not registered.`);let o=[...t.childNodes];NodeGroupManager.pendingChildren.push(o);let n=new i(l,o);e||n.setAttribute("is",t.getAttribute("is").toLowerCase()),t.replaceWith(n);for(let t in l){let e=l[t];t.startsWith("on")&&"function"==typeof e&&n.addEventListener(t.slice(2),(t=>e(t,n)))}let a=t.getAttribute("data-id")||t.getAttribute("id");a&&(this.manager.rootEl[a]=n);for(let e of this.paths)e.nodeMarker===t&&(e.nodeMarker=n),e.nodeBefore===t&&(e.nodeBefore=n);this.startNode===t&&(this.startNode=n),this.endNode===t&&(this.endNode=n),n.renderFirstTime&&n.renderFirstTime();for(let e of t.attributes)"_is"!==e.name&&n.setAttribute(e.name,e.value);for(let t in r){let e=r[t];"boolean"==typeof e?!1!==e&&null!=e&&n.setAttribute(t,""):["number","bigint","string"].includes(typeof e)&&n.setAttribute(t,e)}return n}getNodes(){let t=this.nodesCache;if(t)return t;t=[];let e=this.startNode,l=this.endNode?.nextSibling;for(;e&&e!==l;)t.push(e),e=e.nextSibling;return this.nodesCache=t,t}getParentNode(){return this.startNode?.parentNode}updateStyles(){if(this.styles)for(let[t,e]of this.styles)e!==t.textContent&&Util.bindStyles(t,this.manager.rootEl)}}let componentHash=new WeakMap;class NodeGroupManager{rootEl;rootNg;changes=[];nodeGroupsAvailable=new MultiValueMap;nodeGroupsInUse=[];options={};constructor(t=null){this.rootEl=t}findAndDeleteExact(t,e=!0,l=void 0){let s=this.nodeGroupsAvailable.delete(t,l);if(s){let t=this.nodeGroupsAvailable.delete(s.closeKey,s);if(this.nodeGroupsInUse.push(s),s.inUse=!0,t.inUse=!0,e){let t=s;for(;t=t?.parentPath?.parentNg;)if(!t.inUse){t.inUse=!0;let e=this.nodeGroupsAvailable.delete(t.exactKey,t);this.nodeGroupsAvailable.delete(t.closeKey,t),e&&this.nodeGroupsInUse.push(t)}}for(let t of s.paths)for(let e of t.nodeGroups)e.inUse||this.findAndDeleteExact(e.exactKey,!1,e),e.inUse=!0;return s}return null}findAndDeleteClose(t,e,l=!0){let s=this.nodeGroupsAvailable.delete(t);if(s){if(this.nodeGroupsAvailable.delete(s.exactKey,s),s.inUse=!0,l){let t=s;for(;t=t?.parentPath?.parentNg;)if(!t.inUse){t.inUse=!0;let e=this.nodeGroupsAvailable.delete(t.exactKey,t);e=this.nodeGroupsAvailable.delete(t.closeKey,t),this.nodeGroupsInUse.push(t)}}s.exactKey=e,s.closeKey=t,this.nodeGroupsInUse.push(s)}return s}getNodeGroup(t,e=null,l=!1){let s,r=getObjectHash(t);if(!0===e){if(s=this.findAndDeleteExact(r),!s)return null}else{let e=t.getCloseKey();s=l?null:this.findAndDeleteClose(e,r),s?(window.debug&&!window.ng&&(window.ng=s),s.applyExprs(t.exprs)):(s=new NodeGroup(t,this),s.exactKey=r,s.closeKey=e,l?this.nodeGroupsAvailable.add(s.exactKey,s):this.nodeGroupsInUse.push(s))}return s.parentPath&&(s.parentPath=null),s}reset(){let t=this.nodeGroupsAvailable;for(let e of this.nodeGroupsInUse)e.inUse=!1,t.add(e.exactKey,e),t.add(e.closeKey,e);this.nodeGroupsInUse=[],this.changes=[]}clearSubscribers=!1;getLoopInfo(t){let e=serializePath(t);return[...this.pathToLoopInfo.getAll(e)]}pathToLoopInfo=new MultiValueMap;subscribers=new MultiValueMap;clearSubscribersIfNeeded(){this.clearSubscribers&&(this.pathToLoopInfo=new MultiValueMap,this.subscribers=new MultiValueMap,this.clearSubscribers=!1)}static get(t=null){if(!t)return new NodeGroupManager;let e=nodeGroupManagers.get(t);return e||(e=new NodeGroupManager(t),nodeGroupManagers.set(t,e)),e}}NodeGroupManager.pendingChildren=[];let nodeGroupManagers=new WeakMap;class LoopInfo{constructor(t,e){this.template=t,this.itemTransformer=e}}function r(t=void 0,...e){if(Array.isArray(t))return new Template(t,e);if(!(t instanceof Node)){if("string"==typeof t||t instanceof String){t.match(/^\s^</)&&(t=t.trim());let e=document.createElement("template");return e.innerHTML=t,1===e.content.childNodes.length?e.content.firstChild:e.content}if(void 0===t)return(t,...e)=>r(t,...e).render();if(t instanceof Template)return t.render();if("function"==typeof t){let l=t,s=l();if("string"==typeof s)throw Error(`Please add the "r" prefix before the string "${s}"`);s.replaceMode=!0;let r=s.render();r.render=(()=>{s=l(),s.render(r)}).bind(r);let i=e[0];for(let t in i)r[t]="function"==typeof i[t]?i[t].bind(r):i[t];return r}throw Error("Unsupported arguments.")}{let l=t,s=e[0];if(!(e[0]instanceof Template)){if(!e.length||e[0]){l.shadowRoot&&(l.innerHTML="");let t=e[0];return(e,...s)=>(rendered.add(l),r(e,...s).render(l,t))}throw Error("unsupported")}s.render(l,e[1]),!l.childNodes.length&&this&&l.append(this.rootNg.getParentNode())}}let rendered=new WeakSet;function defineClass(t,e,l){if(!customElements.getName(t)){(e=e||camelToDashes(t.name)).includes("-")||(e+="-element");let s=null;l&&(s={extends:l}),customElements.define(e,t,s)}}let elementClasses={},connected=new WeakSet;function createSolarite(t=null){let e=HTMLElement;t&&!t.includes("-")&&(t=t.toLowerCase(),e=elementClasses[t],e||(e=document.createElement(t).constructor,elementClasses[t]=e));let l=new Proxy(e,{construct:(e,l,s)=>(defineClass(s,null,t),Reflect.construct(e,l,s))});return class extends l{onConnect=Util$1.callback();onFirstConnect=Util$1.callback();onDisconnect=Util$1.callback();constructor(t={}){super(),!0===t.render?this.render():!1===t.render&&rendered.add(this);let e=NodeGroupManager.pendingChildren.pop();e&&(this.querySelector("slot")||this).append(...e),Object.defineProperty(this,"html",{set(e){rendered.add(this),"string"==typeof e?(console.warn("Assigning to this.html without the r template prefix."),this.innerHTML=e):this.modifications=r(this,e,t)}})}renderFirstTime(){!rendered.has(this)&&this.render&&this.render()}connectedCallback(){this.renderFirstTime(),connected.has(this)||(connected.add(this),this.onFirstConnect()),this.onConnect()}disconnectedCallback(){this.onDisconnect()}static define(e=null){defineClass(this,e,t)}renderWatched(){let t=NodeGroupManager.get(this),e=[];for(let l of t.changes)if("set"===l.action)for(let s of l.transformerInfo){let l=s.hash,r=delve(watchSet(s.path[0]),s.path.slice(1)),i=s.transformer(r),o=getObjectHash(i),n=[...t.nodeGroupsAvailable.data[l]];for(let t of n)e.push([t,l,o,i.exprs,s])}else if("delete"===l.action)for(let e of l.value){let l=[...t.nodeGroupsAvailable.getAll(e)];for(let t of l){t.parentPath&&t.parentPath.clearNodesCache();for(let e of t.getNodes())e.remove()}}else if("insert"===l.action){let e=l.beforeTemplate?t.getNodeGroup(l.beforeTemplate,!0):null,s=[l.root,...l.path];for(let r of t.getLoopInfo([l.root,...l.path.slice(0,-1)])){let i=e?.startNode||r.template.parentPath.nodeMarker,o=0;for(let n of l.value){let l=r.itemTransformer,n=watchGet([...s.slice(0,-1),1*s.at(-1)+o+""],l);o++;let a=t.getNodeGroup(n,!1,!0);a.parentPath=e?.parentPath||r.template.parentPath;for(let t of a.getNodes())i.parentNode.insertBefore(t,i);a.parentPath&&a.parentPath.clearNodesCache()}}}for(let[l,s,r,i,o]of e)l.applyExprs(i),t.nodeGroupsAvailable.data[s].delete(l),l.exactKey=o.hash=r,t.nodeGroupsAvailable.add(l.exactKey,l);return t.changes=[],[]}getArg(t,e=null,l=ArgType.String){throw Error("deprecated")}}}let Solarite=new Proxy(createSolarite(),{apply:(t,e,l)=>createSolarite(...l)});export{ArgType,Solarite,Template,forEach,getArg,r,watch,watchGet,watchSet};