// Version 2025.2.3.2250
// License: MIT
// http://vorticode.github.io/solarite
var Util$1={callback(...t){var e=!1;let l=async(...t)=>{let s=[];if(!e)for(let e=0;l.length>e;e++)s.push(l[e](...t));return await Promise.all(s)};l[Symbol.iterator]=()=>{let t=0;return{next(){return l.length>t?{value:l[t++],done:!1}:{done:!0}}}};for(let t of Object.getOwnPropertyNames(Array.prototype))"length"!==t&&"constructor"!==t&&(l[t]=Array.prototype[t]);l.l=0,Object.defineProperty(l,"length",{get:()=>l.l,set(t){l.l=t}}),l.remove=t=>{let e=l.findIndex((e=>e===t));-1!==e&&l.splice(e,1)},l.pause=()=>e=!0,l.resume=()=>e=!1;for(let e of t)l.push(e);return l},mapAdd(t,e,l){let s=t instanceof Map||t instanceof WeakMap,i=s?t.get(e):t[e];i?i.push(l):(i=[l],s?t.set(e,i):t[e]=i)},weakMemoize(t,e){let l=weakMemoizeInputs.get(t);return l||(l=e(t),weakMemoizeInputs.set(t,l)),l}};let weakMemoizeInputs=new WeakMap;function delve(t,e,l=delveDontCreate){let s=l!==delveDontCreate,i=e.length;if(!t&&!s&&i)return;let r=0;for(let o of e){if(void 0===t[o]){if(!s)return;i-1>r&&(t[o]=(e[r+1]+"").match(/^\d+$/)?[]:{})}s&&r===i-1&&(t[o]=l),t=t[o],r++}return t}let delveDontCreate={};function getArg(el,attributeName,defaultValue=void 0,type=ArgType.String,fallback=void 0){let val=defaultValue,attrVal=el.getAttribute(attributeName),result;if(null!==attrVal&&(val=attrVal),Array.isArray(type))return type.includes(val)?val:fallback;if("function"==typeof type)return type(val);if(type===ArgType.Bool){let t="string"==typeof val?val.toLowerCase():val;return!["false","0",!1,0,null,void 0,NaN].includes(t)&&(!(!["true",!0].includes(t)&&0===parseFloat(t))||fallback)}switch(type){case ArgType.Int:return result=parseInt(val),isNaN(result)?fallback:result;case ArgType.Float:return result=parseFloat(val),isNaN(result)?fallback:result;case ArgType.String:return[void 0,null,!1].includes(val)?"":val+"";case ArgType.JSON:case ArgType.Eval:if("string"!=typeof val||!val.length)return fallback;try{return type===ArgType.JSON?JSON.parse(val):eval(`(${val})`)}catch(t){return val}default:return val}}var ArgType={Bool:"Bool",Int:"Int",Float:"Float",String:"String",JSON:"JSON",Eval:"Eval"};let lastObjectId=1,objectIds=new WeakMap;function getObjectId(t){let e=objectIds.get(t);return e||(e="~\f"+lastObjectId++,objectIds.set(t,e)),e}let isHashing=!0;function toJSON(){return isHashing?getObjectId(this):this}function getObjectHash(t){let e;Node.prototype.toJSON!==toJSON&&(Node.prototype.toJSON=toJSON,(()=>{}).toJSON!==toJSON&&(Function.prototype.toJSON=toJSON)),isHashing=!0;try{e=JSON.stringify(t)}catch(l){e=getObjectHashCircular(t)}return isHashing=!1,e}function getObjectHashCircular(t){const e=new Set;return JSON.stringify(t,((t,l)=>{if("object"==typeof l&&null!==l){if(e.has(l))return getObjectId(l);e.add(l)}return l}))}var Globals;function reset(){Globals={componentHash:new WeakMap,connected:new WeakSet,div:document.createElement("div"),rendered:new WeakSet,currentExprPath:null,elementClasses:{},nodeEvents:new WeakMap,nodeGroups:new WeakMap,objToEl:new WeakMap,pendingChildren:[],rendering:new WeakSet,shells:new WeakMap,reset}}reset();var Globals$1=Globals;let Util={bindStyles(t,e){let l=e.getAttribute("data-style");l||(e.constructor.styleId||(e.constructor.styleId=1),l=e.constructor.styleId++,e.setAttribute("data-style",l));let s=e.tagName.toLowerCase();for(let e of t.childNodes)if(3===e.nodeType){let t=e.textContent,i=t.replace(/:host(?=[^a-z0-9_])/gi,`${s}[data-style="${l}"]`);t!==i&&(e.textContent=i)}},*flatten(t){if(Array.isArray(t))for(const e of t)yield*Util.flatten(e);else if("function"==typeof t){const e=t();yield*Util.flatten(e)}else yield t},getInputValue:t=>"checkbox"===t.type||"radio"===t.type?t.checked:"file"===t.type?[...t.files]:"number"===t.type||"range"===t.type?t.valueAsNumber:"date"===t.type||"time"===t.type||"datetime-local"===t.type?t.valueAsDate:"select-multiple"===t.type?[...t.selectedOptions].map((t=>t.value)):t.value,isPath:t=>Array.isArray(t)&&t.length>=2&&("object"==typeof t[0]||void 0===t[0])&&!t.slice(1).find((t=>"string"!=typeof t&&"number"!=typeof t)),isFalsy:t=>void 0===t||!1===t||null===t,isPrimitive:t=>"string"==typeof t||"number"==typeof t,trimEmptyNodes(t){const e=t=>t.nodeType!==Node.ELEMENT_NODE&&(t.nodeType!==Node.TEXT_NODE||""===t.textContent.trim()),l=[...t];for(;l.length>0&&e(l[0]);)l.shift();for(;l.length>0&&e(l[l.length-1]);)l.pop();return l}},isEvent=t=>t.startsWith("on")&&t in Globals$1.div;function camelToDashes(t){return(t=(t=(t=t.replace(/([a-z0-9])([A-Z])/g,"$1-$2")).replace(/([A-Z])([A-Z][a-z])/g,"$1-$2")).replace(/([a-zA-Z])([0-9])/g,"$1-$2")).toLowerCase()}function arraySame(t,e){let l=t.length;if(l!==e.length)return!1;for(let s=0;l>s;s++)if(t[s]!==e[s])return!1;return!0}function htmlContext(t){if(null===t)return state={...defaultState},state.context;for(let e=0;t.length>e;e++){const l=t[e];switch(state.context){case htmlContext.Text:"<"===l&&t[e+1].match(/[a-z!]/i)&&(state.context=htmlContext.Tag,state.buffer="");break;case htmlContext.Tag:if(">"===l)state.context=htmlContext.Text,state.quote=null,state.buffer="";else{if(" "===l&&!state.buffer)continue;" "===l||"/"===l||"?"===l?state.buffer="":'"'===l||"'"===l||"="===l?(state.context=htmlContext.Attribute,state.quote="="===l?null:l,state.buffer=""):state.buffer+=l}break;case htmlContext.Attribute:state.quote||state.buffer.length||'"'!==l&&"'"!==l?l===state.quote||!state.quote&&state.buffer.length?(state.context=htmlContext.Tag,state.quote=null,state.buffer=""):state.quote||">"!==l?" "!==l&&(state.buffer+=l):(state.context=htmlContext.Text,state.quote=null,state.buffer=""):state.quote=l}}return state.context}htmlContext.Attribute="Attribute",htmlContext.Text="Text",htmlContext.Tag="Tag";let defaultState={context:htmlContext.Text,quote:null,buffer:"",lastChar:null},state={...defaultState};class MultiValueMap{data={};add(t,e){let l=this.data,s=l[t];s||(s=new Set,l[t]=s),s.add(e)}isEmpty(){for(let t in this.data)return!0;return!1}getAll(t){return this.data[t]||[]}delete(t,e=void 0){let l,s=this.data,i=s[t];if(i)return void 0===e?([l]=i,i.delete(l)):(i.delete(e),l=e),0===i.size&&delete s[t],l}deleteAny(t,e=void 0){let l,s=this.data,i=s[t];if(i)return[l]=i,i.delete(l),0===i.size&&delete s[t],l}deleteSpecific(t,e){let l,s=this.data,i=s[t];if(i)return i.delete(e),l=e,0===i.size&&delete s[t],l}deletePreferred(t,e){let l,s=this.data,i=s[t];if(i){for(let t of i)if(t?.parentNode===e){i.delete(t),l=t;break}return l||([l]=i,i.delete(l)),0===i.size&&delete s[t],l}}hasValue(t){let e=this.data,l=[];for(let s in e)e[s].has(t)&&l.push(s);return l}}const udomdiff=(t,e,l,s)=>{const i=l.length;let r=e.length,o=i,a=0,n=0,h=null;for(;r>a||o>n;)if(r===a){const e=i>o?n?l[n-1].nextSibling:l[o-n]:s;for(;o>n;){let s=l[n++];t.insertBefore(s,e)}}else if(o===n)for(;r>a;){let l=e[a];h&&h.has(l)||t.removeChild(l),a++}else if(e[a]===l[n])a++,n++;else if(e[r-1]===l[o-1])r--,o--;else if(e[a]===l[o-1]&&l[n]===e[r-1]){const s=e[--r].nextSibling;let i=l[n++],h=e[a++];t.insertBefore(i,h.nextSibling);let f=l[--o];t.insertBefore(f,s),e[r]=l[o]}else{if(!h){h=new Map;let t=n;for(;o>t;)h.set(l[t],t++)}if(h.has(e[a])){const s=h.get(e[a]);if(s>n&&o>s){let i=a,f=1;for(;++i<r&&o>i&&h.get(e[i])===s+f;)f++;if(f>s-n){const i=e[a];for(;s>n;){let e=l[n++];t.insertBefore(e,i)}}else{let s=e[a++],i=l[n++];t.replaceChild(i,s)}}else a++}else{let l=e[a++];t.removeChild(l)}}return l};class ExprPath{type;attrName;attrValue;attrNames;nodeBefore;nodeMarker;parentNg;nodeGroups=[];nodesCache;nodeBeforeIndex;nodeMarkerPath;watchFunction;mapCallback;constructor(t,e,l=ExprPathType.Content,s=null,i=null){this.nodeBefore=t,this.nodeMarker=e,this.type=l,this.attrName=s,this.attrValue=i,l===ExprPathType.Multiple&&(this.attrNames=new Set)}apply(t){switch(this.type){case 1:this.applyNodes(t[0]);break;case 2:this.applyMultipleAttribs(this.nodeMarker,t[0]);break;case 5:break;case 6:this.applyEventAttrib(this.nodeMarker,t[0],this.parentNg.rootNg.root);break;default:this.applyValueAttrib(this.nodeMarker,t)}}applyNodes(t){let e=this;e.freeNodeGroups();let l=[],s=e.nodeGroups,i=[];e.nodeGroups=[],e.applyExact(t,l,i),this.existingTextNodes=null;let r=!1;if(i.length){for(let[t,s]of i){let i=e.getNodeGroup(l[t],!1),o=i.getNodes();1===o.length?l[t]=o[0]:(l[t]=o,r=!0),e.nodeGroups[s]=i}r&&(l=l.flat())}let o=e.getNodes();if(!arraySame(o,l)){e.nodesCache=l,this.parentNg.parentPath&&this.parentNg.parentPath.clearNodesCache(),o.length&&!l.length&&e.fastClear()||udomdiff(e.nodeMarker.parentNode,o,l,e.nodeMarker);for(let t of s)t.startNode.parentNode||t.saveOrphans()}}applyLoopItemUpdate(t,e){let l=this.nodeGroups[t];this.nodeGroupsAttached.add(l.exactKey,l),this.nodeGroupsAttached.add(l.closeKey,l);let s=this.getNodeGroup(e,!0);if(!s){s=this.getNodeGroup(e,!1),this.nodeGroups[t]=s;for(let t of s.getNodes())l.startNode.parentNode.insertBefore(t,l.startNode);if(l!==s){for(let t of l.getNodes())t.remove();l.saveOrphans()}this.nodesCache=null}}applyExact(t,e,l){if(t instanceof Template){let s=this.getNodeGroup(t,!0);s?(e.push(...s.getNodes()),this.nodeGroups.push(s)):(l.push([e.length,this.nodeGroups.length]),e.push(t),this.nodeGroups.push(null))}else if(t instanceof Node)t instanceof DocumentFragment?e.push(...t.childNodes):e.push(t);else if(Array.isArray(t))for(let s of t)this.applyExact(s,e,l);else if("function"==typeof t){Globals$1.currentExprPath=this,this.watchFunction=t;let s=t();Globals$1.currentExprPath=null,this.applyExact(s,e,l)}else{let l=Util.isFalsy(t)?"":t+"",s=this.nodeBefore.nextSibling;if(3!==s.nodeType||s.nextSibling!==this.nodeMarker||e.includes(s)){this.existingTextNodes||(this.existingTextNodes=this.getNodes().filter((t=>3===t.nodeType)));let t=this.existingTextNodes.findIndex((t=>t.textContent===l));-1!==t?e.push(...this.existingTextNodes.splice(t,1)):e.push(this.nodeMarker.ownerDocument.createTextNode(l))}else s.textContent!==l&&(s.textContent=l),e.push(s)}}applyMultipleAttribs(t,e){Array.isArray(e)&&(e=e.flat().join(" "));let l=this.attrNames;if(this.attrNames=new Set,e){let l=(e+"").split(/([\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^\s]+))/g).map((t=>t.trim())).filter((t=>t.length));for(let e of l){let[l,s]=e.split(/\s*=\s*/);s=(s||"").replace(/^(['"])(.*)\1$/,"$2"),t.setAttribute(l,s),this.attrNames.add(l)}}for(let e of l)this.attrNames.has(e)||t.removeAttribute(e)}applyEventAttrib(t,e,l){let s,i=this.attrName.slice(2),r=[];if(Array.isArray(e)){if("function"!=typeof e[0])throw Error("is this ever used?");s=e[0],r=e.slice(1)}else s=e;this.bindEvent(t,l,i,i,s,r)}bindEvent(t,e,l,s,i,r,o=!1){let a=Globals$1.nodeEvents.get(t);a||(a={[l]:[,,,]},Globals$1.nodeEvents.set(t,a));let n=a[l];if(n||(a[l]=n=[,,,]),n[0]!==i){let[l,r,a]=n;l&&t.removeEventListener(s,r,o);let h=i,f=l=>h.call(e,...n[2],l,t);n[0]=h,n[1]=f,t.addEventListener(s,f,o)}a[l][2]=r}applyValueAttrib(t,e){let l=e[0];if(Util.isPath(l)){let[e,s]=[l[0],l.slice(1)];if(!e)throw Error(`Solarite cannot bind to <${t.tagName.toLowerCase()} ${this.attrName}=\${[${l.map((t=>t?`'${t}'`:t+"")).join(", ")}]}>.`);let i=delve(e,s);t[this.attrName]=Util.isFalsy(i)?"":i;let r=()=>{let l="value"===this.attrName?Util.getInputValue(t):t[this.attrName];delve(e,s,l)};this.bindEvent(t,s[0],this.attrName,"input",r,[],!0)}else{let s=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),this.attrName)?.set;if(!this.attrValue&&Util.isFalsy(l))s&&(t[this.attrName]=!1),t.removeAttribute(this.attrName);else if(this.attrValue||!0!==l){let i;if(this.attrValue){let t=[];for(let l=0;this.attrValue.length>l;l++)if(t.push(this.attrValue[l]),this.attrValue.length-1>l){let s=e[l];!Util.isFalsy(s)&&Util.isPrimitive(s)&&t.push(s)}i=t.join("")}else i=Util.isPrimitive(l)?l:"";(s?t[this.attrName]:t.getAttribute(this.attrName))!==i&&(s&&(t[this.attrName]=i),t.setAttribute(this.attrName,i))}else s&&(t[this.attrName]=!0),t.setAttribute(this.attrName,"")}}clone(t,e=0){let l,s,i=t,r=e?this.nodeMarkerPath.slice(0,-e):this.nodeMarkerPath;for(let t=r.length-1;t>0;t--)i=i.childNodes[r[t]];let o=i.childNodes;return l=r.length?o[r[0]]:t,this.nodeBefore&&(s=o[this.nodeBeforeIndex]),new ExprPath(s,l,this.type,this.attrName,this.attrValue)}clearNodesCache(){let t=this,e=this.nodeMarker.parentNode;for(;t&&t.nodeMarker.parentNode===e;)t.nodesCache=null,t=t.parentNg?.parentPath}fastClear(){let t=this.nodeBefore.parentNode;return this.nodeBefore===t.firstChild&&this.nodeMarker===t.lastChild&&(t.innerHTML="",t.append(this.nodeBefore,this.nodeMarker),!0)}getNodes(){let t;if(t=this.nodesCache,t)return t;t=[];let e=this.nodeBefore.nextSibling,l=this.nodeMarker;for(;e&&e!==l;)t.push(e),e=e.nextSibling;return this.nodesCache=t,t}getParentNode(){return this.nodeMarker.parentNode}getNodeGroup(t,e=!0){let l,s=this.nodeGroupsAttached;if(e){if(l=this.nodeGroupsAttached.deleteAny(t.getExactKey()),l||(l=this.nodeGroupsDetached.deleteAny(t.getExactKey()),s=this.nodeGroupsDetached),!l)return null;s.deleteSpecific(t.getCloseKey(),l)}else l=this.nodeGroupsAttached.deleteAny(t.getCloseKey()),l||(l=this.nodeGroupsDetached.deleteAny(t.getCloseKey()),s=this.nodeGroupsDetached),l&&(s.deleteSpecific(l.exactKey,l),l.applyExprs(t.exprs),l.exactKey=t.getExactKey());return l||(l=new NodeGroup(t,this)),this.nodeGroupsRendered.push(l),l}isComponent(){return this.type===ExprPathType.Component||this.attrName&&this.nodeMarker.tagName&&this.nodeMarker.tagName.includes("-")}nodeGroupsRendered=[];nodeGroupsAttached=new MultiValueMap;nodeGroupsDetached=new MultiValueMap;freeNodeGroups(){let t=this.nodeGroupsAttached.data,e=this.nodeGroupsDetached.data;for(let l in t){let s=e[l];if(s)for(let e of t[l])s.add(e);else e[l]=t[l]}this.nodeGroupsAttached=new MultiValueMap;let l=this.nodeGroupsAttached;for(let t of this.nodeGroupsRendered)l.add(t.exactKey,t),l.add(t.closeKey,t);this.nodeGroupsRendered=[]}}const ExprPathType={Content:1,Multiple:2,Value:3,Component:4,Comment:5,Event:6};function getNodePath(t){let e=[];for(;;){let l=t.parentNode;if(!l)break;e.push([].indexOf.call(t.parentNode.childNodes,t)),t=l}return e}function resolveNodePath(t,e){for(let l=e.length-1;l>=0;l--)t=t.childNodes[e[l]];return t}class Shell{fragment;paths=[];ids=[];scripts=[];styles=[];staticComponents=[];constructor(t=null){if(!t)return;let e,l=Shell.addPlaceholders(t),s=document.createElement("template");l?s.innerHTML=l:s.content.append(document.createTextNode("")),this.fragment=s.content;let i=[];const r=document.createTreeWalker(s.content,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT);for(;e=r.nextNode();)if(i.map((t=>t.remove())),i=[],1===e.nodeType)for(let t of[...e.attributes]){let l=t.name.match(/^[\ue000-\uf8ff]$/);if(l)this.paths.push(new ExprPath(null,e,ExprPathType.Multiple)),e.removeAttribute(l[0]);else{let l=t.value.split(/[\ue000-\uf8ff]/g);if(l.length>1){let s=2!==l.length||l[0].length||l[1].length?l:null,i=isEvent(t.name)?ExprPathType.Event:ExprPathType.Value;this.paths.push(new ExprPath(null,e,i,t.name,s)),e.setAttribute(t.name,l.join(""))}}}else if(8===e.nodeType&&"!✨!"===e.nodeValue){let t,l=e.previousSibling;l||(l=document.createComment("ExprPath:"+this.paths.length),e.parentNode.insertBefore(l,e)),!e.nextSibling||8===e.nextSibling.nodeType&&"!✨!"===e.nextSibling.textContent?(t=e,t.textContent="ExprPathEnd:"+this.paths.length):(t=e.nextSibling,i.push(e));let s=new ExprPath(l,t,ExprPathType.Content);this.paths.push(s)}else{if(3===e.nodeType&&"TEXTAREA"===e.parentNode?.tagName&&e.textContent.includes("\x3c!--!✨!--\x3e"))throw Error('Textarea can\'t have expressions inside them. Use <textarea value="${...}"> instead.');if(e.nodeType===Node.COMMENT_NODE){let t=e.textContent.split(/[\ue000-\uf8ff]/g);for(let l=0;t.length-1>l;l++){let t=new ExprPath(e.previousSibling,e);t.type=ExprPathType.Comment,this.paths.push(t)}}else if(e.nodeType===Node.TEXT_NODE&&["SCRIPT","STYLE"].includes(e.parentNode?.nodeName)){let t=e.textContent.split(commentPlaceholder);if(t.length>1){let l=[];for(let s=0;t.length>s;s++){let i=document.createTextNode(t[s]);e.parentNode.insertBefore(i,e),s>0&&l.push(i)}for(let t,e=0;t=l[e];e++){let e=new ExprPath(t.previousSibling,t,ExprPathType.Content);this.paths.push(e)}i.push(e)}}}i.map((t=>t.remove()));for(let t of this.fragment.querySelectorAll("[is]"))t.setAttribute("_is",t.getAttribute("is"));for(let t of this.paths)t.nodeBefore&&(t.nodeBeforeIndex=[].indexOf.call(t.nodeBefore.parentNode.childNodes,t.nodeBefore)),t.nodeMarkerPath=getNodePath(t.nodeMarker),t.type===ExprPathType.Value&&1===t.nodeMarker.nodeType&&(t.nodeMarker.tagName.includes("-")||t.nodeMarker.hasAttribute("is"))&&(t.type=ExprPathType.Component);this.findEmbeds()}static addPlaceholders(t){let e={},l=[];htmlContext(null);for(let s=0;t.length>s;s++){let i=t[s],r=htmlContext(i);if(r===htmlContext.Attribute){let t,l;if(i.replace(/<[a-z][a-z0-9]*-[a-z0-9-]+/gi,((e,s)=>{t=s+1,l=e.slice(1)})),l){let s=l+"-solarite-placeholder";i=i.slice(0,t)+s+i.slice(t+l.length),e[l]=s}}l.push(i),t.length-1>s&&l.push(r===htmlContext.Text?commentPlaceholder:String.fromCharCode(attribPlaceholder+s))}let s=l.join("");for(let t in e)s=s.replaceAll(`</${t}>`,`</${e[t]}>`);return s}findEmbeds(){this.scripts=[].map.call(this.fragment.querySelectorAll("scripts"),(t=>getNodePath(t))),this.styles=[].map.call(this.fragment.querySelectorAll("style"),(t=>getNodePath(t)));let t=this.fragment.querySelectorAll("[id],[data-id]");for(let e of t){let t=e.getAttribute("data-id")||e.getAttribute("id");if(Globals$1.div.hasOwnProperty(t))throw Error(`<${e.tagName.toLowerCase()} id="${t}"> can't override existing HTMLElement id property.`)}this.ids=[].map.call(t,(t=>getNodePath(t)));for(let t of this.fragment.querySelectorAll("*"))(t.tagName.includes("-")||t.hasAttribute("_is"))&&(this.paths.find((e=>e.nodeMarker===t))||this.staticComponents.push(getNodePath(t)))}static get(t){let e=Globals$1.shells.get(t);return e||(e=new Shell(t),Globals$1.shells.set(t,e)),e}}const commentPlaceholder="\x3c!--!✨!--\x3e",attribPlaceholder=57344;class NodeGroup{rootNg;parentPath;startNode;endNode;paths=[];exactKey;closeKey;nodesCache;styles;currentComponentProps={};constructor(t,e=null){if(!(this instanceof RootNodeGroup)){let[l,s]=this.init(t,e);this.updatePaths(l,s.paths),this.activateEmbeds(l,s),this.applyExprs(t.exprs)}}init(t,e=null,l=null,s=null){this.exactKey=l||t.getExactKey(),this.closeKey=s||t.getCloseKey(),this.parentPath=e,this.rootNg=e?.parentNg?.rootNg||this,this.template=t,t.nodeGroup=this;let i=Shell.get(t.html),r=i.fragment.cloneNode(!0),o=r.childNodes;return this.startNode=o[0],this.endNode=o[o.length-1],[r,i]}applyExprs(t,e=null){let l,s=t.length-1,i=Array((e=e||this.paths).length);for(let r,o=e.length-1;r=e[o];o--){let a=e[o-1],n=e[o+1];if(r.attrValue?.length>2?(i[o]=t.slice(s-(r.attrValue.length-1)+1,s+1),s-=i[o].length):(i[o]=[t[s]],s--),r.nodeMarker!==this.rootNg.root&&r.isComponent()){if(n&&n.isComponent()&&n.nodeMarker===r.nodeMarker||(l=o),!a||!a.isComponent()||a.nodeMarker!==r.nodeMarker){let t={};for(let s=o;l>=s;s++)t[e[s].attrName]=i[s].length>1?i[s].join(""):i[s][0];this.applyComponentExprs(r.nodeMarker,t);for(let t=o;l>=t;t++)e[t].apply(i[t])}}else r.apply(i[o])}this.updateStyles(),this.nodesCache=null}applyComponentExprs(t,e){let l=getObjectHash(e),s=t.tagName.endsWith("-SOLARITE-PLACEHOLDER"),i=t.hasAttribute("_is");s||i?t=this.createNewComponent(t,s,e):t.render&&Globals$1.componentHash.get(t)!==l&&t.render(e),Globals$1.componentHash.set(t,l)}createNewComponent(t,e=void 0,l=void 0){void 0===e&&(e=!t.hasAttribute("_is"));let s=(e?t.tagName.endsWith("-SOLARITE-PLACEHOLDER")?t.tagName.slice(0,-21):t.tagName:t.getAttribute("is")).toLowerCase(),i={...l||{}};if(t.attributes.length){l||(l={});for(let e of t.attributes)l.hasOwnProperty(e.name)||(l[e.name]=e.value)}let r=customElements.get(s);if(!r)throw Error(`The custom tag name ${s} is not registered.`);let o=new r(l,[...t.childNodes]);e||o.setAttribute("is",t.getAttribute("is").toLowerCase()),t.replaceWith(o);for(let t in l){let e=l[t];if(t.startsWith("on")&&"function"==typeof e&&o.addEventListener(t.slice(2),(t=>e.call(this.rootNg.root,t,o))),Util.isPath(e)){let[l,s]=[e[0],e.slice(1)];if(!l)throw Error(`Solarite cannot bind to <${o.tagName.toLowerCase()} ${t}=\${[${e.map((t=>t?`'${t}'`:t+"")).join(", ")}]}>.`);o.value=delve(l,s),o.addEventListener("input",(e=>{let i="value"===t?Util.getInputValue(o):o[t];delve(l,s,i)}),!0)}}let a=t.getAttribute("data-id")||t.getAttribute("id");a&&delve(this.getRootNode(),a.split(/\./g),o);for(let e of this.paths)e.nodeMarker===t&&(e.nodeMarker=o),e.nodeBefore===t&&(e.nodeBefore=o);this.startNode===t&&(this.startNode=o),this.endNode===t&&(this.endNode=o),o.renderFirstTime&&o.renderFirstTime();for(let e of t.attributes)"_is"!==e.name&&o.setAttribute(e.name,e.value);for(let t in i){let e=i[t];"boolean"==typeof e?!1!==e&&null!=e&&o.setAttribute(t,""):["number","bigint","string"].includes(typeof e)&&o.setAttribute(t,e)}return o}getNodes(){let t=this.nodesCache;if(t)return t;t=[];let e=this.startNode,l=this.endNode?.nextSibling;for(;e&&e!==l;)t.push(e),e=e.nextSibling;return this.nodesCache=t,t}getParentNode(){return this.startNode?.parentNode}getRootNode(){return this.rootNg.root}getRootNodeGroup(){return this.rootNg}saveOrphans(){let t=document.createDocumentFragment();for(let e of this.getNodes())t.append(e)}updatePaths(t,e,l){this.paths.length=e.length;for(let s=0;e.length>s;s++){let i=e[s].clone(t,l);i.parentNg=this,this.paths[s]=i}}updateStyles(){if(this.styles)for(let[t,e]of this.styles)e!==t.textContent&&Util.bindStyles(t,this.getRootNodeGroup().root)}activateEmbeds(root,shell,pathOffset=0){for(let t of shell.staticComponents){pathOffset&&(t=t.slice(0,-pathOffset));let e=resolveNodePath(root,t);root!==e&&this.createNewComponent(e)}let rootEl=this.rootNg.root;if(rootEl){if(!1!==this.options?.ids)for(let t of shell.ids){pathOffset&&(t=t.slice(0,-pathOffset));let e=resolveNodePath(root,t),l=e.getAttribute("data-id")||e.getAttribute("id");if(l){if(rootEl[l]&&!(rootEl[l]instanceof Node))throw Error(`${rootEl.constructor.name}.${l} already has a value.  Can't set it as a reference to <${e.tagName.toLowerCase()} id="${l}">`);delve(rootEl,l.split(/\./g),e)}}if(!1!==this.options?.styles){shell.styles.length&&(this.styles=new Map);for(let t of shell.styles){pathOffset&&(t=t.slice(0,-pathOffset));let e=resolveNodePath(root,t);1===rootEl.nodeType&&(Util.bindStyles(e,rootEl),this.styles.set(e,e.textContent))}}if(!1!==this.options?.scripts)for(let path of shell.scripts){pathOffset&&(path=path.slice(0,-pathOffset));let script=resolveNodePath(root,path);eval(script.textContent)}}}}class RootNodeGroup extends NodeGroup{root;watchedExprPaths={};exprsToRender=new Map;constructor(t,e,l){super(t),this.options=l,this.rootNg=this;let[s,i]=this.init(t),r=0,o=s;if(e){let t;if(Globals$1.nodeGroups.set(e,this),e.childNodes.length&&(t=document.createDocumentFragment(),t.append(...e.childNodes)),this.root=e,isReplaceEl(s,e)){e.append(...s.children[0].childNodes);for(let t of s.children[0].attributes)e.hasAttribute(t.name)||e.setAttribute(t.name,t.value);r=1}else 1===s.childNodes.length&&3===s.childNodes[0].nodeType&&""===s.childNodes[0].textContent||e.append(...s.childNodes);if(t){for(let l of e.querySelectorAll("slot[name]")){let e=l.getAttribute("name");if(e){let s=t.querySelectorAll(`[slot='${e}']`);l.append(...s)}}let l=e.querySelector("slot:not([name])");l?l.append(t):e.append(t)}o=e,this.startNode=e,this.endNode=e}else{let t=getSingleEl(s);this.root=t||s,Globals$1.nodeGroups.set(this.root,this),t&&(o=t,r=1)}this.updatePaths(o,i.paths,r),this.activateEmbeds(o,i,r),this.applyExprs(t.exprs)}clearRenderWatched(){this.watchedExprPaths={}}}function getSingleEl(t){let e=[];for(let l of t.childNodes)if(1===l.nodeType||3===l.nodeType&&l.textContent.trim().length){if(e.length)return null;e.push(l)}return e[0]}function isReplaceEl(t,e){return e.tagName.includes("-")&&1===t.children.length&&t.children[0].tagName.replace("-SOLARITE-PLACEHOLDER","")===e.tagName}class Template{exprs=[];html=[];hashedFields;nodeGroup;constructor(t,e){this.html=t,this.exprs=e}toJSON(){return this.hashedFields||(this.hashedFields=[getObjectId(this.html),this.exprs]),this.hashedFields}render(t=null,e={}){let l,s=!1;if(t){if(l=Globals$1.nodeGroups.get(t),l||(l=new RootNodeGroup(this,t,e),Globals$1.nodeGroups.set(t,l),s=!0),0===l.paths.length&&this.exprs.length||l.paths.length>this.exprs.length)throw Error(`Solarite Error:  Parent HTMLElement ${l.template.html.join("${...}")} and ${l.paths.length} \${value} placeholders can't accomodate a Template with ${this.exprs.length} values.`)}else l=new RootNodeGroup(this,null,e),t=l.getRootNode(),Globals$1.nodeGroups.set(t,l),s=!0;return s||(1!==this.html?.length||this.html[0]?(l.clearRenderWatched(),l.applyExprs(this.exprs)):t.innerHTML=""),t}getExactKey(){return this.exactKey||(this.exactKey=getObjectHash(this)),this.exactKey}getCloseKey(){return this.closeKey||(this.closeKey="@"+this.toJSON()[0]),this.closeKey}}function r(t=void 0,...e){if(!(t instanceof Node)){if(Array.isArray(t))return new Template(t,e);if("string"==typeof t||t instanceof String){t.match(/^\s^</)&&(t=t.trim());let e=document.createElement("template");e.innerHTML=t;let l=Util.trimEmptyNodes(e.content.childNodes);return 1===l.length?l[0]:e.content}if(void 0===t)return(t,...e)=>r(t,...e).render();if(t instanceof Template)return t.render();if("object"==typeof t){let e=t;if(Globals$1.objToEl.has(e))return((...t)=>{let l=r(...t).render();Globals$1.objToEl.set(e,l)}).bind(e);{Globals$1.objToEl.set(e,null),e.render();let t=Globals$1.objToEl.get(e);Globals$1.objToEl.delete(e);for(let l in e)t[l]="function"==typeof e[l]?e[l].bind(t):e[l];return t}}throw Error("Unsupported arguments.")}{let l=t,s=e[0];if(!(e[0]instanceof Template)){l.shadowRoot&&(l.innerHTML="");let t=e[0],s=(e,...s)=>(Globals$1.rendered.add(l),new Template(e,s).render(l,t));return s}if(!(e[0]instanceof Template))throw Error("unsupported");s.render(l,e[1]),!l.childNodes.length&&this&&l.append(this.rootNg.getParentNode())}}function defineClass(t,e,l){if(!customElements.getName(t)){(e=e||camelToDashes(t.name)).includes("-")||(e+="-element");let s=null;l&&(s={extends:l}),customElements.define(e,t,s)}}function createSolarite(t=null){let e=HTMLElement;t&&!t.includes("-")&&(t=t.toLowerCase(),e=Globals$1.elementClasses[t],e||(e=document.createElement(t).constructor,Globals$1.elementClasses[t]=e));let l=new Proxy(e,{construct:(e,l,s)=>(defineClass(s,null,t),Reflect.construct(e,l,s))});return class extends l{onConnect=Util$1.callback();onFirstConnect=Util$1.callback();onDisconnect=Util$1.callback();constructor(t={}){super(),!0===t.render?this.render():!1===t.render&&Globals$1.rendered.add(this),Object.defineProperty(this,"html",{set(e){Globals$1.rendered.add(this),"string"==typeof e?(console.warn("Assigning to this.html without the r template prefix."),this.innerHTML=e):this.modifications=r(this,e,t)}})}renderFirstTime(){!Globals$1.rendered.has(this)&&this.render&&this.render()}connectedCallback(){this.renderFirstTime(),Globals$1.connected.has(this)||(Globals$1.connected.add(this),this.onFirstConnect()),this.onConnect()}disconnectedCallback(){this.onDisconnect()}static define(e=null){defineClass(this,e,t)}}}let unusedArg=Symbol("unusedArg");function map(t,e){let l=[];for(let s=0;t.length>s;s++)l.push(e(t[s],s,t));return l}function watch3(t,e,l=unusedArg){l!==unusedArg?t[e]=l:l=t[e];const s={get(i,r,o){let a=i===o&&e===r?l:Reflect.get(i,r,o);if("map"===r)return t=>function e(){let l=e.newValue||i;return Globals$1.currentExprPath.mapCallback=t,map(new Proxy(l,s),t)};if(Globals$1.currentExprPath){let l=Globals$1.nodeGroups.get(t);l.watchedExprPaths[e]=l.watchedExprPaths[e]||new Set,l.watchedExprPaths[e].add(Globals$1.currentExprPath)}return a&&"object"==typeof a?new Proxy(a,s):a},set(s,i,r,o){s===o&&e===i?l=r:Reflect.set(s,i,r,o);let a=Globals$1.nodeGroups.get(t);for(let t of a.watchedExprPaths[e])Array.isArray(s)&&parseInt(i)==i?!0!==a.exprsToRender.get(t)&&Util$1.mapAdd(a.exprsToRender,t,[s,i,r]):a.exprsToRender.set(t,new NewValue(r));return!0}};Object.defineProperty(t,e,{get(){return s.get(t,e,t)},set(l){return s.set(t,e,l,t)}})}function renderWatched(t){let e=Globals$1.nodeGroups.get(t),l=[];for(let[t,s]of e.exprsToRender)if(s instanceof NewValue)t.watchFunction.newValue=s.value,t.apply([t.watchFunction]),t.freeNodeGroups(),l.push(...t.getNodes());else for(let e of s){let[s,i,r]=e,o=t.mapCallback(r);t.applyLoopItemUpdate(i,o),l.push(...t.nodeGroups[i].getNodes())}return e.exprsToRender=new Map,l}class NewValue{constructor(t){this.value=t}}let Solarite=new Proxy(createSolarite(),{apply:(t,e,l)=>createSolarite(...l)}),getInputValue=Util.getInputValue;export{ArgType,Globals$1 as Globals,Solarite,Template,delve,getArg,getInputValue,r,renderWatched,watch3 as watch};