// Version 2025.6.15.0459
// License: MIT
// http://vorticode.github.io/solarite
var Util$1={callback(...t){var e=!1;let s=async(...t)=>{let l=[];if(!e)for(let e=0;s.length>e;e++)l.push(s[e](...t));return await Promise.all(l)};s[Symbol.iterator]=()=>{let t=0;return{next(){return s.length>t?{value:s[t++],done:!1}:{done:!0}}}};for(let t of Object.getOwnPropertyNames(Array.prototype))"length"!==t&&"constructor"!==t&&(s[t]=Array.prototype[t]);s.l=0,Object.defineProperty(s,"length",{get:()=>s.l,set(t){s.l=t}}),s.remove=t=>{let e=s.findIndex((e=>e===t));-1!==e&&s.splice(e,1)},s.pause=()=>e=!0,s.resume=()=>e=!1;for(let e of t)s.push(e);return s},mapArrayAdd(t,e,s){let l=t instanceof Map||t instanceof WeakMap,i=l?t.get(e):t[e];i?i.push(s):(i=[s],l?t.set(e,i):t[e]=i)},weakMemoize(t,e){let s=weakMemoizeInputs.get(t);return s||(s=e(t),weakMemoizeInputs.set(t,s)),s}};let weakMemoizeInputs=new WeakMap;var Globals;function reset(){Globals={componentArgsHash:new WeakMap,connected:new WeakSet,currentExprPath:null,div:document.createElement("div"),elementClasses:{},htmlProps:{},nodeEvents:new WeakMap,nodeGroups:new WeakMap,objToEl:new WeakMap,rendered:new WeakSet,rendering:new WeakSet,shells:new WeakMap,reset,count:0}}reset();var Globals$1=Globals;function delve(t,e,s=delveDontCreate){let l=s!==delveDontCreate,i=e.length;if(!t&&!l&&i)return;let r=0;for(let o of e){if(void 0===t[o]){if(!l)return;i-1>r&&(t[o]=(e[r+1]+"").match(/^\d+$/)?[]:{})}l&&r===i-1&&(t[o]=s),t=t[o],r++}return t}let delveDontCreate={},Util={bindId(t,e){let s=e.getAttribute("data-id")||e.getAttribute("id");if(s){if(t[s]&&!(t[s]instanceof Node))throw Error(`${t.constructor.name}.${s} already has a value.  Can't set it as a reference to <${e.tagName.toLowerCase()} id="${s}">`);delve(t,s.split(/\./g),e)}},bindStyles(t,e){let s=e.getAttribute("data-style");s||(e.constructor.styleId||(e.constructor.styleId=1),s=e.constructor.styleId++,e.setAttribute("data-style",s));let l=e.tagName.toLowerCase();for(let e of t.childNodes)if(3===e.nodeType){let t=e.textContent,i=t.replace(/:host(?=[^a-z0-9_])/gi,`${l}[data-style="${s}"]`);t!==i&&(e.textContent=i)}},camelToDashes:t=>(t=(t=(t=t.replace(/([a-z0-9])([A-Z])/g,"$1-$2")).replace(/([A-Z])([A-Z][a-z])/g,"$1-$2")).replace(/([a-zA-Z])([0-9])/g,"$1-$2")).toLowerCase(),dashesToCamel:t=>t.replace(/-([a-z])/g,(t=>t[1].toUpperCase())),*flatten(t){if(Array.isArray(t))for(const e of t)yield*Util.flatten(e);else if("function"==typeof t){const e=t();yield*Util.flatten(e)}else yield t},getInputValue:t=>"checkbox"===t.type||"radio"===t.type?t.checked:"file"===t.type?[...t.files]:"number"===t.type||"range"===t.type?t.valueAsNumber:"date"===t.type||"time"===t.type||"datetime-local"===t.type?t.valueAsDate:"select-multiple"===t.type?[...t.selectedOptions].map((t=>t.value)):t.value,isHtmlProp(t,e){let s=t.tagName+"."+e,l=Globals$1.htmlProps[s];if(void 0===l){let i=Object.getPrototypeOf(t);for(;i;){const t=i.constructor.name;if(t.startsWith("HTML")&&t.endsWith("Element"))break;i=Object.getPrototypeOf(i)}Globals$1.htmlProps[s]=l=!!i&&!!Object.getOwnPropertyDescriptor(i,e)?.set}return l},isPath:t=>Array.isArray(t)&&t.length>=2&&("object"==typeof t[0]||void 0===t[0])&&!t.slice(1).find((t=>"string"!=typeof t&&"number"!=typeof t)),isFalsy:t=>void 0===t||!1===t||null===t,isPrimitive:t=>"string"==typeof t||"number"==typeof t,makePrimitive:t=>"function"==typeof t?Util.makePrimitive(t()):t instanceof Date?t.toISOString().replace(/T/," "):Array.isArray(t)||"object"==typeof t?"":t,trimEmptyNodes(t){const e=t=>t.nodeType!==Node.ELEMENT_NODE&&(t.nodeType!==Node.TEXT_NODE||""===t.textContent.trim()),s=[...t];for(;s.length>0&&e(s[0]);)s.shift();for(;s.length>0&&e(s[s.length-1]);)s.pop();return s}},isEvent=t=>t.startsWith("on")&&t in Globals$1.div;function arraySame(t,e){let s=t.length;if(s!==e.length)return!1;for(let l=0;s>l;l++)if(t[l]!==e[l])return!1;return!0}function getArg(el,attributeName,defaultValue=void 0,type=ArgType.String,fallback=void 0){let val=defaultValue,attrVal=el.getAttribute(attributeName)||el.getAttribute(Util.camelToDashes(attributeName)),result;if(null!==attrVal&&(val=attrVal),Array.isArray(type))return type.includes(val)?val:fallback;if("function"==typeof type)return type(val);if(type===ArgType.Bool){let t="string"==typeof val?val.toLowerCase():val;return!["false","0",!1,0,null,void 0,NaN].includes(t)&&(!(!["true",!0].includes(t)&&0===parseFloat(t))||fallback)}switch(type){case ArgType.Int:return result=parseInt(val),isNaN(result)?fallback:result;case ArgType.Float:return result=parseFloat(val),isNaN(result)?fallback:result;case ArgType.String:return[void 0,null,!1].includes(val)?"":val+"";case ArgType.Json:case ArgType.Eval:if("string"!=typeof val||!val.length)return val;try{return type===ArgType.Json?JSON.parse(val):eval(`(${val})`)}catch(t){return val}default:return val}}var ArgType={Bool:"Bool",Int:"Int",Float:"Float",String:"String",JSON:"Json",Json:"Json",Eval:"Eval"};let lastObjectId=1,objectIds=new WeakMap;function getObjectId(t){let e=objectIds.get(t);return e||(e="~\f"+lastObjectId++,objectIds.set(t,e)),e}let isHashing=!0;function toJSON(){return isHashing?getObjectId(this):this}function getObjectHash(t){let e;Node.prototype.toJSON!==toJSON&&(Node.prototype.toJSON=toJSON,(()=>{}).toJSON!==toJSON&&(Function.prototype.toJSON=toJSON)),isHashing=!0;try{e=JSON.stringify(t)}catch(s){e=getObjectHashCircular(t)}return isHashing=!1,e}function getObjectHashCircular(t){const e=new Set;return JSON.stringify(t,((t,s)=>{if("object"==typeof s&&null!==s){if(e.has(s))return getObjectId(s);e.add(s)}return s}))}class MultiValueMap{data={};add(t,e){let s=this.data,l=s[t];l||(l=new Set,s[t]=l),l.add(e)}isEmpty(){for(let t in this.data)return!0;return!1}getAll(t){return this.data[t]||[]}delete(t,e=void 0){let s,l=this.data,i=l[t];if(i)return void 0===e?([s]=i,i.delete(s)):(i.delete(e),s=e),0===i.size&&delete l[t],s}deleteAny(t){let e,s=this.data,l=s[t];if(l)return[e]=l,l.delete(e),0===l.size&&delete s[t],e}deleteSpecific(t,e){let s,l=this.data,i=l[t];if(i)return i.delete(e),s=e,0===i.size&&delete l[t],s}deletePreferred(t,e){let s,l=this.data,i=l[t];if(i){for(let t of i)if(t?.parentNode===e){i.delete(t),s=t;break}return s||([s]=i,i.delete(s)),0===i.size&&delete l[t],s}}hasValue(t){let e=this.data,s=[];for(let l in e)e[l].has(t)&&s.push(l);return s}}const udomdiff=(t,e,s,l)=>{const i=s.length;let r=e.length,o=i,a=0,n=0,h=null;for(;r>a||o>n;)if(r===a){const e=i>o?n?s[n-1].nextSibling:s[o-n]:l;for(;o>n;){let l=s[n++];t.insertBefore(l,e)}}else if(o===n)for(;r>a;){let s=e[a];h&&h.has(s)||t.removeChild(s),a++}else if(e[a]===s[n])a++,n++;else if(e[r-1]===s[o-1])r--,o--;else if(e[a]===s[o-1]&&s[n]===e[r-1]){const l=e[--r].nextSibling;let i=s[n++],h=e[a++];t.insertBefore(i,h.nextSibling);let f=s[--o];t.insertBefore(f,l),e[r]=s[o]}else{if(!h){h=new Map;let t=n;for(;o>t;)h.set(s[t],t++)}if(h.has(e[a])){const l=h.get(e[a]);if(l>n&&o>l){let i=a,f=1;for(;++i<r&&o>i&&h.get(e[i])===l+f;)f++;if(f>l-n){const i=e[a];for(;l>n;){let e=s[n++];t.insertBefore(e,i)}}else{let l=e[a++],i=s[n++];t.replaceChild(i,l)}}else a++}else{let s=e[a++];t.removeChild(s)}}return s};let unusedArg=Symbol("unusedArg");function removeProxy(t){return t&&t.$removeProxy?t.$removeProxy:t}function renderWatched(t,e=!1){let s,l=Globals$1.nodeGroups.get(t);e&&(s=new Set);for(let[t,i]of l.exprsToRender)if(i instanceof WholeArrayOp)i.markNodeGroupsAvailable(t),t.watchFunction.newValue=i.array,t.apply([t.watchFunction],!1),e&&s.add(...t.getNodes());else if(i instanceof ValueOp)t.watchFunction.newValue=i.value,t.apply([t.watchFunction],!1),e&&s.add(...t.getNodes());else for(let l=0;i.length>l;l++){let r=i[l],o=i[l+1];if(o instanceof ArraySpliceOp&&1===o.deleteCount&&1===o.items.length&&r instanceof ArraySpliceOp&&1===r.deleteCount&&1===r.items.length&&o.array[o.index]===r.firstDeleted&&r.array[r.index]===o.firstDeleted){let i=t.nodeGroups[r.index],a=t.nodeGroups[o.index],n=i.endNode.nextSibling,h=a.endNode.nextSibling;for(let t of i.getNodes())t.parentNode.insertBefore(t,h);for(let t of a.getNodes())t.parentNode.insertBefore(t,n);t.nodeGroups[r.index]=a,t.nodeGroups[o.index]=i,e&&(i.getNodes().map((t=>s.add(t))),a.getNodes().map((t=>s.add(t)))),l++}else e&&r.deleteCount&&s.add(...t.nodeGroups.slice(r.index,r.index+r.deleteCount).map((t=>t.getNodes())).flat()),r.markNodeGroupsAvailable(t),t.applyArrayOp(r),e&&r.items.length&&t.nodeGroups.slice(r.index,r.index+r.items.length).map((t=>t.getNodes())).flat().map((t=>s.add(t)))}if(l.exprsToRender=new Map,e)return[...s]}class ProxyHandler{proxies={};exprPaths=new Set;childExprPaths={};constructor(t,e){this.root=t,this.value=e,this.rootNodeGroup=null}getProxyandHandler(t,e){let s=this.proxies[t];if(!s){let l=new ProxyHandler(this.root,this.value);s=this.proxies[t]=[new Proxy(e,l),l]}return s}get(t,e,s){if("$removeProxy"===e)return t;const l=t===s?this.value:Reflect.get(t,e,s);if(Array.isArray(t)){if("map"===e){const e=this;return s=>function l(){const i=Globals$1.currentExprPath;i&&e.exprPaths.add(i);const r=l.newValue||t;Globals$1.currentExprPath.mapCallback=s;let o=new Proxy(r,e);return[].map.call(o,s)}}if("push"===e||"pop"===e||"splice"===e){const s=Globals$1.nodeGroups.get(this.root);return new WatchedArray(s,t,this.exprPaths)[e]}}const i=Globals$1.currentExprPath;if(l&&"object"==typeof l){let[t,s]=this.getProxyandHandler(e,l);return i&&"constructor"!==e&&s.exprPaths.add(i),t}return i&&"constructor"!==e&&(this.childExprPaths[e]?this.childExprPaths[e].add(i):this.childExprPaths[e]=new Set([i])),l}set(t,e,s,l){s=removeProxy(s),this.rootNodeGroup||(this.rootNodeGroup=Globals$1.nodeGroups.get(this.root));const i=this.rootNodeGroup;let r=s&&"object"==typeof s?this.getProxyandHandler(e,s)[1].exprPaths:this.childExprPaths[e]||[];const o=Array.isArray(t);for(let l of r)o?Number.isInteger(+e)?i.exprsToRender.get(l)instanceof WholeArrayOp||Util$1.mapArrayAdd(i.exprsToRender,l,new ArraySpliceOp(t,e,1,[s])):i.exprsToRender.set(l,new WholeArrayOp(s)):i.exprsToRender.set(l,new ValueOp(s));return t===l?this.value=s:Reflect.set(t,e,s,l),s&&"object"==typeof s&&delete this.proxies[e],!0}}function watch(t,e,s=unusedArg){s!==unusedArg?t[e]=s:s=t[e];let l=new ProxyHandler(t,s);Object.defineProperty(t,e,{get(){return l.get(t,e,t)},set(s){return l.set(t,e,s,t)}})}class WatchedArray{constructor(t,e,s){this.rootNg=t,this.array=e,this.exprPaths=s,this.push=this.push.bind(this),this.pop=this.pop.bind(this),this.splice=this.splice.bind(this)}push(...t){return this.internalSplice("push",t,[this.array,this.array.length,0,t])}pop(){if(this.array.length)return this.internalSplice("pop",[],[this.array,this.array.length-1,1])}splice(...t){return this.internalSplice("splice",t,[this.array,...t])}internalSplice(t,e,s){for(let t of this.exprPaths)this.rootNg.exprsToRender.get(t)instanceof WholeArrayOp||Util$1.mapArrayAdd(this.rootNg.exprsToRender,t,new ArraySpliceOp(...s));return Array.prototype[t].call(this.array,...e)}}class WatchOp{}class ArraySpliceOp extends WatchOp{constructor(t,e,s,l=[]){super(),this.array=t,this.index=1*e,this.deleteCount=s,this.items=l,this.firstDeleted=1===s?t[e]:void 0}markNodeGroupsAvailable(t){if(this.deleteCount>0){let e=this.index+this.deleteCount;for(let s=this.index;e>s;s++){let e=t.nodeGroups[s];t.nodeGroupsAttachedAvailable.add(e.exactKey,e),t.nodeGroupsAttachedAvailable.add(e.closeKey,e)}}}}class ValueOp extends WatchOp{constructor(t){super(),this.value=t}markNodeGroupsAvailable(t){}}class WholeArrayOp extends WatchOp{constructor(t,e){super(),this.array=t,this.value=e}markNodeGroupsAvailable(t){for(let e=0;t.nodeGroups.length>e;e++){let s=t.nodeGroups[e];t.nodeGroupsAttachedAvailable.add(s.exactKey,s),t.nodeGroupsAttachedAvailable.add(s.closeKey,s)}}}class ExprPath{type;attrName;attrValue;attrNames;nodeBefore;nodeMarker;parentNg;nodeGroups=[];nodesCache;nodeBeforeIndex;nodeMarkerPath;watchFunction;mapCallback;constructor(t,e,s=ExprPathType.Content,l=null,i=null){this.nodeBefore=t,this.nodeMarker=e,this.type=s,this.attrName=l,this.attrValue=i,s===ExprPathType.AttribMultiple&&(this.attrNames=new Set)}apply(t,e=!0){switch(this.type){case 1:this.applyNodes(t[0],e);break;case 2:this.applyMultipleAttribs(this.nodeMarker,t[0]);break;case 5:break;case 6:this.applyEventAttrib(this.nodeMarker,t[0],this.parentNg.rootNg.root);break;default:this.applyValueAttrib(this.nodeMarker,t)}}applyNodes(t,e=!0){let s=this;e&&s.freeNodeGroups();let l=[],i=s.nodeGroups,r=[];s.nodeGroups=[],s.applyExactNodes(t,l,r);let o=!1;if(r.length){for(let[t,e]of r){let i=s.getNodeGroup(l[t],!1),r=i.getNodes();1===r.length?l[t]=r[0]:(l[t]=r,o=!0),s.nodeGroups[e]=i}o&&(l=l.flat())}let a=s.getNodes();if(!arraySame(a,l)){s.nodesCache=l,this.parentNg.parentPath&&this.parentNg.parentPath.clearNodesCache(),a.length&&!l.length&&s.fastClear()||udomdiff(s.nodeMarker.parentNode,a,l,s.nodeMarker);for(let t of i)t.startNode.parentNode||t.removeAndSaveOrphans()}}applyArrayOp(t){let e=Math.min(t.deleteCount,t.items.length),s=t.deleteCount-e;for(let s=0;e>s;s++){let e=this.nodeGroups[t.index+s],l=(this.mapCallback||this.watchFunction)(t.items[s]);this.exprToTemplates(l,(l=>{let i=this.getNodeGroup(l,!0);if(i&&i===e);else{i||(i=this.getNodeGroup(l,!1)),this.nodeGroups[t.index+s]=i;let r=e.startNode;for(let t of i.getNodes())r.parentNode.insertBefore(t,r);i!==e&&e.removeAndSaveOrphans()}}))}if(s>0){for(let l=0;s>l;l++)this.nodeGroups[t.index+e+l].removeAndSaveOrphans();this.nodeGroups.splice(t.index+e,s)}else{let s=t.items.slice(e),l=this.nodeGroups[t.index+e]?.startNode||this.nodeMarker;for(let t=0;s.length>t;t++){let e=this.mapCallback(s[t]),i=this.getNodeGroup(e,!0);i||(i=this.getNodeGroup(e,!1)),this.nodeGroups.push(i);for(let t of i.getNodes())l.parentNode.insertBefore(t,l)}}this.nodesCache=null}exprToTemplates(t,e){if(Array.isArray(t))for(let s of t)this.exprToTemplates(s,e);else if("function"==typeof t)Globals$1.currentExprPath=this,this.watchFunction=t,t=t(),Globals$1.currentExprPath=null,this.exprToTemplates(t,e);else if(t instanceof Template||t instanceof Node)e(t);else{void 0===t||!1===t||null===t?t="":"string"!=typeof t&&(t+="");let s=new Template([t],[]);this.exprToTemplates(s,e)}}applyExactNodes(t,e,s){if(t instanceof Template){let l=this.getNodeGroup(t,!0);l?(e.push(...l.getNodes()),this.nodeGroups.push(l)):(s.push([e.length,this.nodeGroups.length]),e.push(t),this.nodeGroups.push(null))}else t instanceof Node?t instanceof DocumentFragment?e.push(...t.childNodes):e.push(t):this.exprToTemplates(t,(t=>{this.applyExactNodes(t,e,s)}))}applyMultipleAttribs(t,e){Array.isArray(e)&&(e=e.flat().join(" "));let s=this.attrNames;if(this.attrNames=new Set,e){"function"==typeof e&&(Globals$1.currentExprPath=this,this.watchFunction=e,e=e(),Globals$1.currentExprPath=null);let s=(e+"").split(/([\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^\s]+))/g).map((t=>t.trim())).filter((t=>t.length));for(let e of s){let[s,l]=e.split(/\s*=\s*/);l=(l||"").replace(/^(['"])(.*)\1$/,"$2"),t.setAttribute(s,l),this.attrNames.add(s)}}for(let e of s)this.attrNames.has(e)||t.removeAttribute(e)}applyEventAttrib(t,e,s){let l,i=this.attrName.slice(2),r=[];if(Array.isArray(e)&&"function"==typeof e[0])l=e[0],r=e.slice(1);else{if("function"!=typeof e)throw Error(`Invalid event binding: <${t.tagName.toLowerCase()} ${this.attrName}=\${${JSON.stringify(e)}}>`);l=e}this.bindEvent(t,s,i,i,l,r)}bindEvent(t,e,s,l,i,r,o=!1){let a=Globals$1.nodeEvents.get(t);a||(a={[s]:[,,,]},Globals$1.nodeEvents.set(t,a));let n=a[s];if(n||(a[s]=n=[,,,]),"function"!=typeof i)throw Error(`Solarite cannot bind to <${t.tagName.toLowerCase()} ${this.attrName}=\${${i}}> because it's not a function.`);if(n[0]!==i){let[s,r,a]=n;s&&t.removeEventListener(l,r,o);let h=i,f=s=>h.call(e,...n[2],s,t);n[0]=h,n[1]=f,t.addEventListener(l,f,o)}a[s][2]=r}applyValueAttrib(t,e){let s=e[0];if(Util.isPath(s)){let[e,l]=[s[0],s.slice(1)];if(!e)throw Error(`Solarite cannot bind to <${t.tagName.toLowerCase()} ${this.attrName}=\${[${s.map((t=>t?`'${t}'`:t+"")).join(", ")}]}>.`);let i=delve(e,l);if("value"===this.attrName&&"select-multiple"===t.type&&Array.isArray(i)){let e=i.map((t=>t+""));for(let s of t.options)s.selected=e.includes(s.value)}else{let e=Util.isFalsy(i)?"":i;e!==t[this.attrName]&&(t[this.attrName]=e)}let r=()=>{let s="value"===this.attrName?Util.getInputValue(t):t[this.attrName];delve(e,l,s)};this.bindEvent(t,l[0],this.attrName,"input",r,[],!0)}else{let l=Util.isHtmlProp(t,this.attrName),i=this.attrValue;if(i||(Globals$1.currentExprPath=this,"function"==typeof s?(this.watchFunction=s,s=s()):s=Util.makePrimitive(s),Globals$1.currentExprPath=null),i||void 0!==s&&!1!==s&&null!==s)if(i||!0!==s){let r;if(i){let t=[];for(let s=0;this.attrValue.length>s;s++)if(t.push(this.attrValue[s]),this.attrValue.length-1>s){Globals$1.currentExprPath=this;let l=Util.makePrimitive(e[s]);Globals$1.currentExprPath=null,Util.isFalsy(l)||t.push(l)}r=t.join("")}else r=s;(l?t[this.attrName]:t.getAttribute(this.attrName))!==r&&(l&&(t[this.attrName]=r),t.setAttribute(this.attrName,r))}else l&&(t[this.attrName]=!0),t.setAttribute(this.attrName,"");else l&&(t[this.attrName]=!1),t.removeAttribute(this.attrName)}}clone(t,e=0){let s,l,i=t,r=e?this.nodeMarkerPath.slice(0,-e):this.nodeMarkerPath;for(let t=r.length-1;t>0;t--)i=i.childNodes[r[t]];let o=i.childNodes;return s=r.length?o[r[0]]:t,this.nodeBefore&&(l=o[this.nodeBeforeIndex]),new ExprPath(l,s,this.type,this.attrName,this.attrValue)}clearNodesCache(){let t=this,e=this.nodeMarker.parentNode;for(;t&&t.nodeMarker.parentNode===e;)t.nodesCache=null,t=t.parentNg?.parentPath}fastClear(){let t=this.nodeBefore.parentNode;return this.nodeBefore===t.firstChild&&this.nodeMarker===t.lastChild&&(t.innerHTML="",t.append(this.nodeBefore,this.nodeMarker),!0)}getNodes(){if(this.type===ExprPathType.AttribValue||this.type===ExprPathType.AttribMultiple||this.type===ExprPathType.ComponentAttribValue)return[this.nodeMarker];let t;if(t=this.nodesCache,t)return t;t=[];let e=this.nodeBefore.nextSibling,s=this.nodeMarker;for(;e&&e!==s;)t.push(e),e=e.nextSibling;return this.nodesCache=t,t}getParentNode(){return this.nodeMarker.parentNode}getNodeGroup(t,e=!0){let s,l=this.nodeGroupsAttachedAvailable;if(e){if(s=l.deleteAny(t.getExactKey()),s||(l=this.nodeGroupsDetachedAvailable,s=l.deleteAny(t.getExactKey())),!s)return null;l.deleteSpecific(t.getCloseKey(),s)}else t.exprs.length&&(s=l.deleteAny(t.getCloseKey()),s||(l=this.nodeGroupsDetachedAvailable,s=l.deleteAny(t.getCloseKey())),s&&(l.deleteSpecific(s.exactKey,s),s.applyExprs(t.exprs),s.exactKey=t.getExactKey()));return s||(s=new NodeGroup(t,this)),this.nodeGroupsRendered.push(s),s}isComponent(){return this.type===ExprPathType.ComponentAttribValue||this.attrName&&this.nodeMarker.tagName&&this.nodeMarker.tagName.includes("-")}nodeGroupsRendered=[];nodeGroupsAttachedAvailable=new MultiValueMap;nodeGroupsDetachedAvailable=new MultiValueMap;freeNodeGroups(){let t=this.nodeGroupsAttachedAvailable.data,e=this.nodeGroupsDetachedAvailable.data;for(let s in t){let l=e[s];if(l)for(let e of t[s])l.add(e);else e[s]=t[s]}this.nodeGroupsAttachedAvailable=new MultiValueMap;let s=this.nodeGroupsAttachedAvailable;for(let t of this.nodeGroupsRendered)s.add(t.exactKey,t),s.add(t.closeKey,t);this.nodeGroupsRendered=[]}}const ExprPathType={Content:1,AttribMultiple:2,AttribValue:3,ComponentAttribValue:4,Comment:5,Event:6};function getNodePath(t){let e=[];for(;;){let s=t.parentNode;if(!s)break;e.push([].indexOf.call(t.parentNode.childNodes,t)),t=s}return e}function resolveNodePath(t,e){for(let s=e.length-1;s>=0;s--)t=t.childNodes[e[s]];return t}class HtmlParser{constructor(){this.defaultState={context:HtmlParser.Text,quote:null,buffer:"",lastChar:null},this.state={...this.defaultState}}reset(){return this.state={...this.defaultState},this.state.context}parse(t,e=null){if(null===t)return this.reset();for(let s=0;t.length>s;s++){const l=t[s];switch(this.state.context){case HtmlParser.Text:"<"===l&&t[s+1].match(/[/a-z!]/i)&&(e?.(t,s,this.state.context,HtmlParser.Tag),this.state.context=HtmlParser.Tag,this.state.buffer="");break;case HtmlParser.Tag:if(">"===l)e?.(t,s+1,this.state.context,HtmlParser.Text),this.state.context=HtmlParser.Text,this.state.quote=null,this.state.buffer="";else{if(" "===l&&!this.state.buffer)continue;" "===l||"/"===l||"?"===l?this.state.buffer="":'"'===l||"'"===l||"="===l?(e?.(t,s,this.state.context,HtmlParser.Attribute),this.state.context=HtmlParser.Attribute,this.state.quote="="===l?null:l,this.state.buffer=""):this.state.buffer+=l}break;case HtmlParser.Attribute:this.state.quote||this.state.buffer.length||'"'!==l&&"'"!==l?l===this.state.quote||!this.state.quote&&this.state.buffer.length?(e?.(t,s,this.state.context,HtmlParser.Tag),this.state.context=HtmlParser.Tag,this.state.quote=null,this.state.buffer=""):this.state.quote||">"!==l?" "!==l&&(this.state.buffer+=l):(e?.(t,s+1,this.state.context,HtmlParser.Text),this.state.context=HtmlParser.Text,this.state.quote=null,this.state.buffer=""):this.state.quote=l}}return e?.(t,t.length,this.state.context,null),this.state.context}}HtmlParser.Attribute="Attribute",HtmlParser.Text="Text",HtmlParser.Tag="Tag";class Shell{fragment;paths=[];ids=[];scripts=[];styles=[];staticComponents=[];constructor(t=null){if(!t)return;if(1===t.length&&!t[0].match(/[<&]/))return void(this.fragment=document.createTextNode(t[0]));let e,s=Shell.addPlaceholders(t),l=document.createElement("template");s?l.innerHTML=s:l.content.append(document.createTextNode("")),this.fragment=l.content;let i=[],r=0;const o=document.createTreeWalker(this.fragment,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT);for(;e=o.nextNode();)if(i.map((t=>t.remove())),i=[],1===e.nodeType)for(let t of[...e.attributes]){let s=t.name.match(/^[\ue000-\uf8ff]$/);if(s)this.paths.push(new ExprPath(null,e,ExprPathType.AttribMultiple)),r++,e.removeAttribute(s[0]);else{let s=t.value.split(/[\ue000-\uf8ff]/g);if(s.length>1){let l=2!==s.length||s[0].length||s[1].length?s:null,i=isEvent(t.name)?ExprPathType.Event:ExprPathType.AttribValue;this.paths.push(new ExprPath(null,e,i,t.name,l)),r+=s.length-1,e.setAttribute(t.name,s.join(""))}}}else if(8===e.nodeType&&"!✨!"===e.nodeValue){let t,s=e.previousSibling;s||(s=document.createComment("ExprPath:"+this.paths.length),e.parentNode.insertBefore(s,e)),!e.nextSibling||8===e.nextSibling.nodeType&&"!✨!"===e.nextSibling.textContent?(t=e,t.textContent="ExprPathEnd:"+this.paths.length):(t=e.nextSibling,i.push(e));let l=new ExprPath(s,t,ExprPathType.Content);this.paths.push(l),r++}else{if(3===e.nodeType&&"TEXTAREA"===e.parentNode?.tagName&&e.textContent.includes("\x3c!--!✨!--\x3e"))throw Error('Textarea can\'t have expressions inside them. Use <textarea value="${...}"> instead.');if(e.nodeType===Node.COMMENT_NODE){let t=e.textContent.split(/[\ue000-\uf8ff]/g);for(let s=0;t.length-1>s;s++){let t=new ExprPath(e.previousSibling,e);t.type=ExprPathType.Comment,this.paths.push(t),r++}}else if(e.nodeType===Node.TEXT_NODE&&["SCRIPT","STYLE"].includes(e.parentNode?.nodeName)){let t=e.textContent.split(commentPlaceholder);if(t.length>1){let s=[];for(let l=0;t.length>l;l++){let i=document.createTextNode(t[l]);e.parentNode.insertBefore(i,e),l>0&&s.push(i)}for(let t,e=0;t=s[e];e++){let e=new ExprPath(t.previousSibling,t,ExprPathType.Content);this.paths.push(e),r++}i.push(e)}}}if(i.map((t=>t.remove())),r!==t.length-1)throw Error("Could not parse expressions in template.  Check for duplicate attributes or malformed html: "+t.join("${...}"));for(let t of this.fragment.querySelectorAll("[is]"))t.setAttribute("_is",t.getAttribute("is"));for(let t of this.paths)t.nodeBefore&&(t.nodeBeforeIndex=[].indexOf.call(t.nodeBefore.parentNode.childNodes,t.nodeBefore)),t.nodeMarkerPath=getNodePath(t.nodeMarker),t.type===ExprPathType.AttribValue&&1===t.nodeMarker.nodeType&&(t.nodeMarker.tagName.includes("-")||t.nodeMarker.hasAttribute("is"))&&(t.type=ExprPathType.ComponentAttribValue);this.findEmbeds()}static addPlaceholders(t){let e=[];function s(t,s){s===HtmlParser.Tag&&(t=t.replace(/^<\/?[a-z][a-z0-9]*-[a-z0-9-]+/i,(t=>t+"-solarite-placeholder"))),e.push(t)}let l=new HtmlParser;for(let i=0;t.length>i;i++){let r=0,o=l.parse(t[i],((t,e,l,i)=>{r!==e&&s(t.slice(r,e),l),r=e}));t.length-1>i&&e.push(o===HtmlParser.Text?commentPlaceholder:String.fromCharCode(attribPlaceholder+i))}return e.join("")}findEmbeds(){this.scripts=[].map.call(this.fragment.querySelectorAll("scripts"),(t=>getNodePath(t))),this.styles=[].map.call(this.fragment.querySelectorAll("style"),(t=>getNodePath(t)));let t=this.fragment.querySelectorAll("[id],[data-id]");for(let e of t){let t=e.getAttribute("data-id")||e.getAttribute("id");if(Globals$1.div.hasOwnProperty(t))throw Error(`<${e.tagName.toLowerCase()} id="${t}"> can't override existing HTMLElement id property.`)}this.ids=[].map.call(t,(t=>getNodePath(t)));for(let t of this.fragment.querySelectorAll("*"))(t.tagName.includes("-")||t.hasAttribute("_is"))&&(this.paths.find((e=>e.nodeMarker===t))||this.staticComponents.push(getNodePath(t)))}static get(t){let e=Globals$1.shells.get(t);return e||(e=new Shell(t),Globals$1.shells.set(t,e)),e}}const commentPlaceholder="\x3c!--!✨!--\x3e",attribPlaceholder=57344;class NodeGroup{rootNg;parentPath;startNode;endNode;paths=[];exactKey;closeKey;nodesCache;styles;constructor(t,e=null){if(!(this instanceof RootNodeGroup)){let[s,l]=this.init(t,e);if(s&&t.exprs.length){this.updatePaths(s,l.paths);let e=this.findStaticComponents(s,l);this.activateEmbeds(s,l),this.applyExprs(t.exprs),this.activateStaticComponents(e)}else l&&this.activateEmbeds(s,l)}}init(t,e=null,s=null,l=null){if(this.exactKey=s||t.getExactKey(),this.closeKey=l||t.getCloseKey(),this.parentPath=e,this.rootNg=e?.parentNg?.rootNg||this,this.template=t,t.nodeGroup=this,this instanceof RootNodeGroup||t.exprs.length||t.html[0].includes("<")){let e=Shell.get(t.html),s=e.fragment.cloneNode(!0);if(s instanceof DocumentFragment){let t=s.childNodes;this.startNode=t[0],this.endNode=t[t.length-1]}else this.startNode=this.endNode=s;return[s,e]}{let e=document.createTextNode(t.html[0]);return this.startNode=this.endNode=e,[]}}applyExprs(t,e=null){let s,l=t.length-1,i=Array((e=e||this.paths).length);for(let r,o=e.length-1;r=e[o];o--){let a=e[o-1],n=e[o+1];if(r.attrValue?.length>2?(i[o]=t.slice(l-(r.attrValue.length-1)+1,l+1),l-=i[o].length):(i[o]=[t[l]],l--),r.nodeMarker!==this.rootNg.root&&r.isComponent()){if(n&&n.isComponent()&&n.nodeMarker===r.nodeMarker||(s=o),!a||!a.isComponent()||a.nodeMarker!==r.nodeMarker){let t={};for(let l=o;s>=l;l++)t[e[l].attrName]=i[l].length>1?i[l].join(""):i[l][0];this.applyComponentExprs(r.nodeMarker,t);for(let t=o;s>=t;t++)e[t].apply(i[t])}}else r.apply(i[o])}this.updateStyles(),this.nodesCache=null}applyComponentExprs(t,e){let s=getObjectHash(e),l=t.tagName.endsWith("-SOLARITE-PLACEHOLDER"),i=t.hasAttribute("_is");if(l||i)t=this.createNewComponent(t,l,e);else if(t.render&&Globals$1.componentArgsHash.get(t)!==s){let s={};for(let t in e||{})s[Util.dashesToCamel(t)]=e[t];t.render(s)}Globals$1.componentArgsHash.set(t,s)}createNewComponent(t,e=void 0,s=void 0){void 0===e&&(e=!t.hasAttribute("_is"));let l=(e?t.tagName.slice(0,-21):t.getAttribute("is")).toLowerCase(),i=customElements.get(l);if(!i)throw Error(`The custom tag name ${l} is not registered.`);let r={};for(let t in s||{})r[Util.dashesToCamel(t)]=s[t];if(t.attributes.length)for(let e of t.attributes){let t=Util.dashesToCamel(e.name);r.hasOwnProperty(t)||(r[t]=e.value)}let o=new i(r,[...t.childNodes].filter((t=>t.nodeType!==Node.COMMENT_NODE||!t.nodeValue.startsWith("ExprPath"))));e||o.setAttribute("is",t.getAttribute("is").toLowerCase()),t.replaceWith(o);let a=t.getAttribute("data-id")||t.getAttribute("id");a&&delve(this.getRootNode(),a.split(/\./g),o);for(let e of this.paths)e.nodeMarker===t&&(e.nodeMarker=o),e.nodeBefore===t&&(e.nodeBefore=o);this.startNode===t&&(this.startNode=o),this.endNode===t&&(this.endNode=o),o.renderFirstTime&&o.renderFirstTime();for(let e of t.attributes)"_is"!==e.name&&o.setAttribute(e.name,e.value);for(let t in s){let e=s[t];"boolean"==typeof e?!1!==e&&null!=e&&o.setAttribute(t,""):["number","bigint","string"].includes(typeof e)&&o.setAttribute(t,e)}return o}getNodes(){let t=this.nodesCache;if(t)return t;t=[];let e=this.startNode,s=this.endNode?.nextSibling;for(;e&&e!==s;)t.push(e),e=e.nextSibling;return this.nodesCache=t,t}getParentNode(){return this.startNode?.parentNode}getRootNode(){return this.rootNg.root}getRootNodeGroup(){return this.rootNg}removeAndSaveOrphans(){let t=document.createDocumentFragment();for(let e of this.getNodes())t.append(e)}updatePaths(t,e,s){let l=e.length;this.paths.length=l;for(let i=0;l>i;i++){let l=e[i].clone(t,s);l.parentNg=this,this.paths[i]=l}}updateStyles(){if(this.styles)for(let[t,e]of this.styles)e!==t.textContent&&Util.bindStyles(t,this.getRootNodeGroup().root)}findStaticComponents(t,e,s=0){let l=[];for(let i of e.staticComponents){s&&(i=i.slice(0,-s));let e=resolveNodePath(t,i);t!==e&&l.push(e)}return l}activateStaticComponents(t){for(let e of t)this.createNewComponent(e)}activateEmbeds(root,shell,pathOffset=0){let rootEl=this.rootNg.root;if(rootEl){let options=this.rootNg.options;if(!1!==options?.ids)for(let t of shell.ids){pathOffset&&(t=t.slice(0,-pathOffset));let e=resolveNodePath(root,t);Util.bindId(rootEl,e)}if(!1!==options?.styles){shell.styles.length&&(this.styles=new Map);for(let t of shell.styles){pathOffset&&(t=t.slice(0,-pathOffset));let e=resolveNodePath(root,t);1===rootEl.nodeType&&(Util.bindStyles(e,rootEl),this.styles.set(e,e.textContent))}}if(!1!==options?.scripts)for(let path of shell.scripts){pathOffset&&(path=path.slice(0,-pathOffset));let script=resolveNodePath(root,path);eval(script.textContent)}}}}class RootNodeGroup extends NodeGroup{root;exprsToRender=new Map;constructor(t,e,s){super(t),this.options=s,this.rootNg=this;let[l,i]=this.init(t);if(l instanceof Text)e&&(this.startNode=e,this.endNode=e,l.nodeValue.length&&e.append(l),this.root=e),Globals$1.nodeGroups.set(this.root,this);else{let s=0,r=l;if(e){let t;if(Globals$1.nodeGroups.set(e,this),e.childNodes.length&&(t=document.createDocumentFragment(),t.append(...e.childNodes)),this.root=e,isReplaceEl(l,e)){e.append(...l.children[0].childNodes);for(let t of l.children[0].attributes)e.hasAttribute(t.name)||e.setAttribute(t.name,t.value);s=1}else 1===l.childNodes.length&&3===l.childNodes[0].nodeType&&""===l.childNodes[0].textContent||e.append(...l.childNodes);if(t){for(let s of e.querySelectorAll("slot[name]")){let e=s.getAttribute("name");if(e){let l=t.querySelectorAll(`[slot='${e}']`);s.append(...l)}}let s=e.querySelector("slot:not([name])");s?s.append(t):e.append(t)}r=e,this.startNode=e,this.endNode=e}else{let t=getSingleEl(l);this.root=t||l,Globals$1.nodeGroups.set(this.root,this),t&&(r=t,s=1)}this.updatePaths(r,i.paths,s);let o=this.findStaticComponents(r,i,s);this.activateEmbeds(r,i,s),this.applyExprs(t.exprs),this.activateStaticComponents(o)}}}function getSingleEl(t){let e=[];for(let s of t.childNodes)if(1===s.nodeType||3===s.nodeType&&s.textContent.trim().length){if(e.length)return null;e.push(s)}return e[0]}function isReplaceEl(t,e){return 1===t.children.length&&e.tagName.includes("-")&&t.children[0].tagName.replace("-SOLARITE-PLACEHOLDER","")===e.tagName}class Template{exprs=[];html=[];hashedFields;nodeGroup;constructor(t,e){this.html=t,this.exprs=e}toJSON(){return this.hashedFields||(this.hashedFields=[getObjectId(this.html),this.exprs]),this.hashedFields}render(t=null,e={}){let s,l=!1;if(t){if(s=Globals$1.nodeGroups.get(t),s||(s=new RootNodeGroup(this,t,e),Globals$1.nodeGroups.set(t,s),l=!0),0===s.paths.length&&this.exprs.length||s.paths.length>this.exprs.length)throw Error(`Solarite Error:  Parent HTMLElement ${s.template.html.join("${...}")} and ${s.paths.length} \${value} placeholders can't accomodate a Template with ${this.exprs.length} values.`)}else s=new RootNodeGroup(this,null,e),t=s.getRootNode(),Globals$1.nodeGroups.set(t,s),l=!0;return l||(1!==this.html?.length||this.html[0]?s.applyExprs(this.exprs):t.innerHTML=""),s.exprsToRender=new Map,t}getExactKey(){return this.exactKey||(this.exactKey=this.exprs.length?getObjectHash(this):this.html[0]),this.exactKey}getCloseKey(){return this.closeKey||(this.closeKey=this.exprs.length?this.toJSON()[0]:this.html[0]),this.closeKey}}function r(t=void 0,...e){if(!(t instanceof Node)){if(Array.isArray(t))return new Template(t,e);if("string"==typeof t||t instanceof String){t.match(/^\s^</)&&(t=t.trim());let e=document.createElement("template");e.innerHTML=t;let s=Util.trimEmptyNodes(e.content.childNodes);return 1===s.length?s[0]:e.content}if(void 0===t)return(t,...e)=>r(t,...e).render();if(t instanceof Template)return t.render();if("object"==typeof t){let e=t;if("Object"!==e.constructor.name)throw Error(`Solarate Web Component class ${e.constructor?.name} must extend HTMLElement.`);if(Globals$1.objToEl.has(e))return((...t)=>{let s=r(...t).render();Globals$1.objToEl.set(e,s)}).bind(e);{Globals$1.objToEl.set(e,null),e.render();let t=Globals$1.objToEl.get(e);Globals$1.objToEl.delete(e);for(let s in e)t[s]="function"==typeof e[s]?e[s].bind(t):e[s];return t}}throw Error("Unsupported arguments.")}{let s=t,l=e[0];if(!(e[0]instanceof Template)){s.shadowRoot&&(s.innerHTML="");let t=e[0],l=(e,...l)=>(Globals$1.rendered.add(s),new Template(e,l).render(s,t));return l}if(!(e[0]instanceof Template))throw Error("unsupported");l.render(s,e[1]),!s.childNodes.length&&this&&s.append(this.rootNg.getParentNode())}}function defineClass(t,e,s){if(!customElements.getName(t)){(e=e||Util.camelToDashes(t.name)).includes("-")||(e+="-element");let l=null;s&&(l={extends:s}),customElements.define(e,t,l)}}function createSolarite(t=null){let e=HTMLElement;t&&!t.includes("-")&&(t=t.toLowerCase(),e=Globals$1.elementClasses[t],e||(e=document.createElement(t).constructor,Globals$1.elementClasses[t]=e));let s=new Proxy(e,{construct:(e,s,l)=>(defineClass(l,null,t),Reflect.construct(e,s,l))});return class extends s{onConnect=Util$1.callback();onFirstConnect=Util$1.callback();onDisconnect=Util$1.callback();constructor(t={}){super(),!0===t.render?this.render():!1===t.render&&Globals$1.rendered.add(this)}renderFirstTime(){!Globals$1.rendered.has(this)&&this.render&&this.render()}connectedCallback(){this.renderFirstTime(),Globals$1.connected.has(this)||(Globals$1.connected.add(this),this.onFirstConnect()),this.onConnect()}disconnectedCallback(){this.onDisconnect()}static define(e=null){defineClass(this,e,t)}}}let Solarite=new Proxy(createSolarite(),{apply:(t,e,s)=>createSolarite(...s)}),getInputValue=Util.getInputValue;export{ArgType,Globals$1 as Globals,Solarite,Template,delve,getArg,getInputValue,r,renderWatched,watch};